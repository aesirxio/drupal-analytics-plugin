"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[1540],{71540:(t,s,e)=>{e.r(s),e.d(s,{default:()=>S});var a=e(65004),n=e(4966),i=e(51751),o=e(53800),r=e(81252),l=e(96540),h=e(56347),c=e(27813),d=e(99194),M=e(14630),m=e(95093),g=e.n(m),u=e(44015),D=e(32389),p=class{constructor(){(0,r.M)(this,"getConsentsList",(async(t,s,e,a)=>{try{const n=new d.L20,i=await n.getConsentsList(t,s);i?(0,c.h5)((()=>{e(i)})):a({message:"Something went wrong from Server response"})}catch(t){(0,c.h5)((()=>{t.response?.data.message?a({message:t.response?.data?.message}):a({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,r.M)(this,"getConsentsDate",(async(t,s,e,a)=>{try{const n=new d.L20,i=await n.getConsentsDate(t,s);i?(0,c.h5)((()=>{e(i)})):a({message:"Something went wrong from Server response"})}catch(t){(0,c.h5)((()=>{t.response?.data.message?a({message:t.response?.data?.message}):a({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,r.M)(this,"getConsentsTier",(async(t,s,e,a)=>{try{const n=new d.L20,i=await n.getConsentsTier(t,s);i?(0,c.h5)((()=>{e(i)})):a({message:"Something went wrong from Server response"})}catch(t){(0,c.h5)((()=>{t.response?.data.message?a({message:t.response?.data?.message}):a({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},C=class{constructor(t,s){(0,r.M)(this,"data",[]),(0,r.M)(this,"globalViewModel",null),(0,r.M)(this,"toRaw",(()=>this.data)),(0,r.M)(this,"transformResponse",(()=>{let t={};return this.data?.length>0&&this.data?.forEach((s=>{const e=this.data.filter((t=>t[d.sSJ.EVENT_NAME]===s[d.sSJ.EVENT_NAME]));t={...t,[s[d.sSJ.EVENT_NAME]]:e}})),t})),(0,r.M)(this,"transformConsentsResponse",(()=>{let t={};return this.data?.length>0&&this.data?.forEach((s=>{const e=this.data.filter((t=>t[d.HMX.EVENT_NAME]===s[d.HMX.EVENT_NAME]));t={...t,[s[d.HMX.EVENT_NAME]]:e}})),t})),(0,r.M)(this,"transformAttributeCartResponse",(t=>(this.dataAttr?.length>0&&(this.dataAddToCart={...t}),t))),(0,r.M)(this,"getFilterName",(()=>{const t=this.transformResponse(),s=Object.keys(t).map((t=>({value:t,label:t})));return s?.unshift({value:"all",label:"All"}),s})),(0,r.M)(this,"getListLine",(()=>{const t=this.transformResponse();return Object.keys(t).map((t=>t))})),(0,r.M)(this,"toBarChart",(()=>{const t=this.transformConsentsResponse();return Object.keys(t).map((s=>({name:s,number:t[s]?.reduce(((t,s)=>t+s[d.HMX.TOTAL_VISITOR]),0)})))})),(0,r.M)(this,"handleChangeLink",((t,s)=>{t.preventDefault(),s&&this.globalViewModel.setIntegrationLink(s)})),(0,r.M)(this,"toChartByTier",(()=>this.data.map((t=>({name:"Tier "+t[d.ob1.TIER],value:t[d.ob1.TOTAL]}))))),(0,r.M)(this,"toChartByDate",(()=>{const t=(0,d.jgq)(this.globalViewModel?.dateFilter?.date_start,this.globalViewModel?.dateFilter?.date_end),s=t.map((t=>{const s=this.data.find((s=>g()(s.date).format("YYYY-MM-DD")===t));return{name:t&&g()(t,"YYYY-MM-DD").format("DD MMM"),Total:s?.[d._gJ.TOTAL]??0}})),e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(((t,s)=>{const e=this.data.filter((t=>g()(t?.date).month()===s));let a=0;return e&&(a=e.reduce(((t,s)=>t+s[d._gJ.TOTAL]),0)),{name:t,Total:a}})),a={};t.forEach((t=>{const s=g()(t).startOf("isoWeek"),e=g()(t).endOf("isoWeek"),n=`${s.format("DD MMM")} - ${e.format("DD MMM")}`;a[n]||(a[n]={quantity:0});const i=this.data.filter((t=>g()(t?.date).isBetween(s,e,null,"[]")));if(i){const t=i.reduce(((t,s)=>t+s[d._gJ.TOTAL]),0);a[n].quantity+=t}}));return[{visitors:e},{visitors:s},{visitors:Object.keys(a).map((t=>({name:t,Total:a[t].quantity})))}]})),t&&(this.data=t,this.globalViewModel=s)}},w=class{constructor(t,s){(0,r.M)(this,"data",[]),(0,r.M)(this,"globalViewModel",null),(0,r.M)(this,"toRaw",(()=>this.data)),(0,r.M)(this,"toConsentsListTable",(()=>{const t=["txt_tier","txt_wallet","txt_web3id","txt_datetime","txt_expiration","txt_uuid"],s=[d.Ql_.TIER,d.Ql_.WALLET,d.Ql_.WEB3ID,d.Ql_.DATETIME,d.Ql_.EXPIRATION,d.Ql_.UUID];if(this.data?.length){const e=s.map(((s,e)=>({Header:t[e],accessor:s,width:s===d.Ql_.TIER?50:s===d.Ql_.WEB3ID?100:170,allowSort:!0,Cell:({cell:t,column:s})=>s.id===d.Ql_.WEB3ID?l.createElement("div",{className:"px-15"},t?.value):s.id===d.Ql_.WALLET?l.createElement("div",{className:"px-15"},t?.value?.address):s.id===d.Ql_.DATETIME||s.id===d.Ql_.EXPIRATION?l.createElement("div",{className:"px-15"},t?.value&&g()(t?.value).format("YYYY-MM-DD HH:mm:ss")):l.createElement("div",{className:"px-15"},t?.value)}))),a=this.data?.map((t=>({...t,...s.map((s=>({[s]:t[s]}))).reduce(((t,s)=>({...s,...t})),{})}))),n=a?.map((t=>{for(let e in t)s.includes(e)||delete t[e];return t}));return{header:e,data:n}}return{header:[],data:[]}})),t&&(this.data=t??[],this.globalViewModel=s)}},E=class{constructor(t,s){(0,r.M)(this,"consentsStore",null),(0,r.M)(this,"status",i.s.READY),(0,r.M)(this,"globalStoreViewModel",null),(0,r.M)(this,"data",null),(0,r.M)(this,"dataFilter",{}),(0,r.M)(this,"statusConsentsList",i.s.READY),(0,r.M)(this,"consentsListData",null),(0,r.M)(this,"statusConsentsDate",i.s.READY),(0,r.M)(this,"consentsDateData",null),(0,r.M)(this,"statusConsentsTier",i.s.READY),(0,r.M)(this,"consentsTierData",null),(0,r.M)(this,"sortBy",{"sort[]":"","sort_direction[]":""}),(0,r.M)(this,"initialize",(async(t,s)=>{this.getConsentsList({...t},s),this.getConsentsDate({...t},s),this.getConsentsTier({...t},s)})),(0,r.M)(this,"getConsentsList",((t,s,e={"sort[]":"datetime","sort_direction[]":"desc"})=>{this.statusConsentsList=i.s.LOADING,this.sortBy=e,this.dataFilterConsentsList={page_size:"5",...this.dataFilterConsentsList,...t,...this.sortBy};const a={...this.globalStoreViewModel.dateFilter,...s};this.consentsStore.getConsentsList(this.dataFilterConsentsList,a,this.callbackOnDataConsentsListSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"getConsentsDate",((t,s)=>{this.statusConsentsDate=i.s.LOADING,this.dataFilterConsentsDate={page_size:"999",...this.dataFilterConsentsDate,...t};const e={...this.globalStoreViewModel.dateFilter,...s};this.consentsStore.getConsentsDate(this.dataFilterConsentsDate,e,this.callbackOnDataConsentsDateSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"getConsentsTier",((t,s)=>{this.statusConsentsDate=i.s.LOADING,this.dataFilterConsentsDate={page_size:"999",...this.dataFilterConsentsDate,...t};const e={...this.globalStoreViewModel.dateFilter,...s};this.consentsStore.getConsentsTier(this.dataFilterConsentsDate,e,this.callbackOnDataConsentsTierSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"setDataFilter",(t=>{this.dataFilter=t})),(0,r.M)(this,"handleFilterDateRange",((t,s)=>{this.statusConsentsList=i.s.LOADING,this.statusConsentsDate=i.s.LOADING,this.statusConsentsTier=i.s.LOADING;const e={...this.globalStoreViewModel.dateFilter,date_start:g()(t).format("YYYY-MM-DD"),date_end:g()(s).endOf("day").format("YYYY-MM-DD")};this.dateFilter={...this.dateFilter,...e},this.initialize(this.dataFilter,e)})),(0,r.M)(this,"handleFilterTableConsentsList",(async t=>{this.statusConsentsList=i.s.LOADING,this.dataFilterConsentsList={...this.dataFilterConsentsList,...t};const s={...this.globalStoreViewModel.dateFilter};await this.consentsStore.getConsentsList(this.dataFilterConsentsList,s,this.callbackOnDataConsentsListSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"callbackOnErrorHandler",(t=>{this.status=i.s.READY,(0,M.me)(t.message,"error")})),(0,r.M)(this,"callbackOnDataConsentsListSuccessHandler",(t=>{if(t?.list){this.statusConsentsList=i.s.READY;const s=new w(t.list,this.globalStoreViewModel);this.consentsListData={list:s?.toConsentsListTable(),pagination:t.pagination}}else this.statusConsentsList=i.s.ERROR,this.consentsListData=[]})),(0,r.M)(this,"callbackOnDataConsentsDateSuccessHandler",(t=>{if(t?.list){this.statusConsentsDate=i.s.READY;const s=new C(t?.list,this.globalStoreViewModel);this.consentsDateData={list:s?.toChartByDate(),pagination:t.pagination}}else this.statusConsentsDate=i.s.ERROR,this.consentsDateData=[]})),(0,r.M)(this,"callbackOnDataConsentsTierSuccessHandler",(t=>{if(t?.list){this.statusConsentsTier=i.s.READY;const s=new C(t?.list,this.globalStoreViewModel);this.consentsTierData=s?.toChartByTier()}else this.statusConsentsTier=i.s.ERROR,this.consentsTierData=[]})),(0,c.l_)(this),this.consentsStore=t,this.globalStoreViewModel=s}},L=class{constructor(t,s){(0,r.M)(this,"consentsList",null),(0,r.M)(this,"getConsentsListViewModel",(()=>this.consentsList)),t&&(this.consentsList=new E(t,s))}},b=(0,l.lazy)((()=>Promise.all([e.e(514),e.e(450),e.e(8255),e.e(9121),e.e(6343),e.e(6031)]).then(e.bind(e,36031)))),T=({link:t,...s})=>l.createElement(b,{...s}),_=(0,u.PA)(class extends l.Component{constructor(t){super(t),(0,r.M)(this,"consentsStore",null),(0,r.M)(this,"behaviorViewModel",null);const{viewModel:s}=t;this.viewModel=s||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.consentsStore=new p({}),this.behaviorViewModel=new L(this.consentsStore,this.biListViewModel)}render(){const{integration:t=!1}=this.props,{integrationLink:s,activeDomain:e}=this.biListViewModel;return l.createElement(a.K,{viewModel:this.behaviorViewModel},l.createElement(n.d,{data:this?.behaviorViewModel?.consentsList?.consentsListData?.list?.data,i18n:this.props.i18n,t:this.props.t,componentRef:this.componentRef,sectionName:"consent"}),l.createElement(f,{integration:t,integrationLink:s,activeDomain:e,ref:t=>this.componentRef=t}))}}),f=(0,u.PA)(class extends l.Component{constructor(t){super(t)}render(){return l.createElement("div",{className:"aesirxui"},this.props.integration?l.createElement(T,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):l.createElement(l.Fragment,null,l.createElement(h.qh,{exact:!0,path:["/consents","/bi/consents"]},l.createElement(b,null))))}}),S=(0,D.CI)()((0,h.y)((0,o.cm)(_)))},65004:(t,s,e)=>{e.d(s,{K:()=>i,j:()=>o});var a=e(96540),n=a.createContext(),i=({children:t,viewModel:s})=>a.createElement(n.Provider,{value:s},t),o=()=>a.useContext(n)}}]);