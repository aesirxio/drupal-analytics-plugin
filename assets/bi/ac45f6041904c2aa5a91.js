"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[1942],{87667:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var a=n(88576),s=n(40627),c=(n(47518),n(70303)),r=n(63908),o=n(19618),i=(n(44702),n(67294)),l=n(96042),m=n(45712),u=n(85518),d=n(34051),p=n(31555),g=n(96693),w=n(23123),h=n(67),E=({isConnecting:e,handleOnConnect:t,activeConnectorError:n,activeConnectorType:s,activeConnector:c,noLogin:r})=>i.createElement(i.Fragment,null,i.createElement("div",{className:""},i.createElement(d.Z,null,i.createElement(p.Z,{lg:""+(r?"6":"12")},u.nI?i.createElement("button",{disabled:e,type:"button",className:"btn btn-dark btn-concordium fw-medium text-nowrap py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center justify-content-start w-100 "+(r?"mb-3 mb-lg-0":"mb-3"),onClick:()=>t(a.F0,"browser")},e?i.createElement(i.Fragment,null,i.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Connecting"):i.createElement(i.Fragment,null,i.createElement("img",{src:a.JN,className:"me-3 align-text-bottom",alt:"Concordium",width:24}),"Concordium Browser Wallet")):u.Dt?i.createElement(i.Fragment,null,i.createElement("button",{className:"btn btn-dark btn-concordium flex-grow-1 fw-medium py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center justify-content-start w-100",onClick:()=>t(a.wv,"walletconnect")},n||!s||c?i.createElement(i.Fragment,null,i.createElement("div",{className:"d-flex text-start align-items-center"},i.createElement("p",{className:"mb-0 fs-18 text-nowrap pe-3 me-3 border-end text-nowrap"},"QR Code"),i.createElement("p",{className:"mb-0 fs-12"},"Concordium or CryptoX Mobile Wallets"))):i.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}))):i.createElement(i.Fragment,null)))),u.tq&&u.Dt&&i.createElement("div",{className:"bg-success-light p-3 mt-3 fs-14 text-start"},i.createElement("p",{className:"mb-1 fw-bold"},"Note for Concordium Wallet:"),i.createElement("p",{className:"mb-0"},"Please connect & sign your signature on the app then switch back to the browser to continue"))),b=({account:e,connection:t,setIsAccountExist:n,setExpand:u,setAccountInfo:d,noSignUpForm:p})=>{const[w,h]=(0,i.useState)(""),[E,b]=(0,i.useState)(!0),[f,x]=(0,i.useState)(!1),[y,C]=(0,i.useState)(!1),[N,v]=(0,i.useState)(!1),k="concordium",{noCreateAccount:A,isSignUpForm:S,handleOnData:F,toggle:I,isRequireEmail:W}=(0,i.useContext)(r.Tx),{getWalletNonce:P,verifySignature:L}=(0,s.w)(k,e),R=async()=>{C(!0);try{const t=await(0,r.CD)(e??""),n=await(0,r.WV)(),a=await(0,g.V$)(),s=await a.requestIdProof(e??"",n,t);return await(0,r.xG)(t,s)&&(x(!0),C(!1)),!0}catch(e){return x(!1),C(!1),!1}};return i.createElement(i.Fragment,null,N&&!p?i.createElement(i.Fragment,null,i.createElement("div",{className:"text-start"},i.createElement("div",{className:"cursor-pointer fw-medium fs-14 d-inline-flex align-items-center back-button text-primary",onClick:()=>{v(!1),u("wallet"),n({status:!0,type:""})}},i.createElement("img",{src:o.i,alt:"Back Icon",className:"me-1"}),"Back")),i.createElement("div",{className:"text-primary"},i.createElement(c.N,{setShow:S?I:async()=>{v(!1),u("wallet"),n({status:!0,type:""})},setIsExist:b,setIsAccountExist:n,accountAddress:e,connection:t,wallet:"concordium",isRequireEmail:W}))):i.createElement(i.Fragment,null,i.createElement("button",{disabled:""!==w||y,type:"button",className:"btn btn-dark btn-concordium w-100 fw-medium py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center text-start",onClick:()=>{!E||S?(async()=>{h("loading");try{const t=await(0,r.RJ)(e,k);t?.data?.result?l.Am.error("You've already created an account with this wallet."):(f||await R())&&(v(!0),u("wallet-concordium")),h("")}catch(e){h(""),l.Am.error(e?.response?.data?.error||e?.message)}})():(async()=>{h("connect");const a=await P();if(a)try{h("sign");const n=await t.signMessage(e,(0,m.x2)(`${a}`)),s="object"==typeof n&&null!==n?n:JSON.parse(n);if(n){const t=await L(k,e,s);if(W){const e=await(0,r.L)(t?.access_token);!e?.email||/@aesirx\.io$/.test(e?.email)&&(e?.wallet_concordium&&e?.email?.includes(e?.wallet_concordium)||e?.wallet_metamask&&e?.email?.includes(e?.wallet_metamask))?(u("require-email"),d({data:t,memberId:e?.member_id})):F({...t,loginType:"concordium"})}else F({...t,loginType:"concordium"})}}catch(e){(0,l.Am)(e.message)}else!A&&b(!1),n({status:!1,type:"concordium"});h("")})()}},w?i.createElement("div",{className:"d-flex align-items-center"},i.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),i.createElement("span",{className:"ms-1"},"sign"===w?"Please sign message on the wallet":"loading"===w?"Connecting...":"Please wait to connect...")):!E||S?i.createElement(i.Fragment,null,i.createElement("img",{src:a.JN,className:"me-3 align-text-bottom",alt:"Concordium logo",width:24}),y?i.createElement(i.Fragment,null,i.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),i.createElement("span",{className:"ms-1"},f?"Loading...":"Authorizing")):i.createElement(i.Fragment,null,"Create account via Concordium (",e&&(0,r.Sy)(e),")")):i.createElement(i.Fragment,null,i.createElement("img",{src:a.JN,className:"me-3 align-text-bottom",alt:"Concordium logo",width:24}),"Sign in via Concordium (",e&&(0,r.Sy)(e),")"))))},f=e=>{const{activeConnectorType:t,activeConnector:n,activeConnectorError:a,network:c,connectedAccounts:o,genesisHashes:u,setActiveConnectorType:d,setIsAccountExist:p,setExpand:g,setAccountInfo:f,noLogin:x,setAccountAddress:y,setConnectionProvider:C,setWalletType:N,noSignUpForm:v,setWalletState:k}=e,{connection:A,setConnection:S,account:F,genesisHash:I}=(0,m.Rc)(o,u),{connect:W,connectError:P,isConnecting:L}=(0,m.$4)(n,S),[R,_]=(0,i.useState)(),[T,z]=(0,i.useState)(""),D=(0,m.KJ)(c);(0,i.useEffect)((()=>{D&&(_(void 0),D.getConsensusStatus().then((e=>e.genesisBlock)).then((e=>{const{network:t}=(0,r.zx)();let n=!1;if("testnet"===t)n=h.zv(e)===m.Vr.genesisHash;else n=h.zv(e)===m.RR.genesisHash;if(!n){const{network:e}=(0,r.zx)();throw new Error(`Please change the network to ${e} in Wallet`)}_(e),z("")})).catch((e=>{_(void 0),(0,l.Am)(e.message),z(e.message)})))}),[D]),(0,i.useEffect)((()=>{n&&W()}),[n]),(0,i.useEffect)((()=>{y&&(F&&A?(y(F),C(A),N("concordium")):(y(""),C(null),N(""))),k&&F&&A&&k({wallet:"concordium",accountAddress:F,connection:A})}),[F,A]),(0,i.useEffect)((()=>{P&&"A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received"!==P&&(0,l.Am)(P)}),[P]);return i.createElement(i.Fragment,null,!F||T?i.createElement(E,{isConnecting:L,handleOnConnect:async(e,t)=>{w.Z.setItem("concordium",t),await d(e)},activeConnectorError:a,activeConnectorType:t,activeConnector:n,noLogin:x}):i.createElement(i.Fragment,null,R?x?i.createElement(s.X,{className:"mb-12px",title:"Account Connected:",value:(0,r.Sy)(F,20,5),contentCopy:F}):i.createElement(b,{account:F,connection:A,setIsAccountExist:p,setExpand:g,setAccountInfo:f,noSignUpForm:v,setWalletState:k}):i.createElement("button",{className:"btn btn-dark"},i.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}))),a&&i.createElement("div",{className:"mt-1 fs-7 text-danger text-start"},"Connector error: ",a,"."),T&&i.createElement("div",{className:"mt-1 fs-7 text-danger text-start"},"RPC error: ",T))},x=({setIsAccountExist:e,setExpand:t,setAccountInfo:n,noLogin:a,setAccountAddress:s,setConnection:c,setWalletType:o,noSignUpForm:l=!1,setWalletState:u})=>{const{network:d}=(0,r.zx)();return i.createElement(m.pX,{network:"testnet"===d?m.Vr:m.RR},(r=>i.createElement(f,{...r,setIsAccountExist:e,setExpand:t,setAccountInfo:n,noLogin:a,setAccountAddress:s,setConnectionProvider:c,setWalletType:o,noSignUpForm:l,setWalletState:u})))}},40627:(e,t,n)=>{n.d(t,{X:()=>m,w:()=>u});var a=n(47518),s=n(63908),c=n(65623),r=n(7005),o=n(67294),i=n(96042),l=n(71257),m=({title:e,value:t,className:n,contentCopy:s})=>o.createElement("div",{className:`custom_tags border text-dark rounded-1 mb-0 py-1 px-20px d-flex justify-content-between fw-semibold ${n}`},o.createElement("span",{className:"d-flex align-items-center"},o.createElement(r.G,{icon:c.f8,width:16,height:16,className:"text-success me-1"}),e),o.createElement("p",{className:"mb-0"},t," ",s&&o.createElement(a.x,{content:s,isBlack:!0,className:"bg-transparent border-0 text-dark px-1"}))),u=(e,t)=>{const{endpoint:n}=(0,s.zx)();return{getWalletNonce:async()=>{try{const a={method:"post",url:`${n}/index.php?webserviceClient=site&webserviceVersion=1.0.0&option=member&task=getWalletNonce&api=hal`,headers:{"Content-Type":"application/json"},data:{publicAddress:t,wallet:e,text:"Login with nonce: {}"}},{data:s}=await(0,l.Z)(a);if(s.result)return s.result;throw!1}catch(e){return!1}},verifySignature:async(e,t,a)=>{try{const s=new URLSearchParams(window.location.search)?.get("return"),c=new URLSearchParams(window.location.search)?.get("channel_type"),r=new URLSearchParams(window.location.search)?.get("organisationId"),o={wallet:e,publicAddress:t,signature:a,...c&&{channel_type:c},...s&&{return:s},...r&&{organisationId:r}},i={method:"post",url:`${n}/index.php?webserviceClient=site&webserviceVersion=1.0.0&option=member&task=walletLogin&api=hal&return=${s??null}`,headers:{"Content-Type":"application/json"},data:o},{data:m}=await(0,l.Z)(i);if(m?.result)return m?.result;throw!1}catch(e){return(0,i.Am)("Wrong authentication",{closeOnClick:!1}),!1}}}}},65623:(e,t,n)=>{var a=n(86843);t.DF={prefix:a.prefix,iconName:a.iconName,icon:[a.width,a.height,a.aliases,a.unicode,a.svgPathData]},t.f8=t.DF,a.prefix,a.iconName,a.width,a.height,a.aliases,a.unicode,a.svgPathData,a.aliases},86843:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var n="circle-check",a=[61533,"check-circle"],s="f058",c="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z";t.definition={prefix:"fas",iconName:n,icon:[512,512,a,s,c]},t.faCircleCheck=t.definition,t.prefix="fas",t.iconName=n,t.width=512,t.height=512,t.ligatures=a,t.unicode=s,t.svgPathData=c,t.aliases=a}}]);