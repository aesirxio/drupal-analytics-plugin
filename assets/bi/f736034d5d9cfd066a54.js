"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[3944],{23944:(e,t,s)=>{s.r(t),s.d(t,{default:()=>V});var a=s(5504),r=s(55270),n=s(4966),i=s(51751),l=s(53800),o=s(81252),h=s(96540),c=s(56347),d=s(54625),m=s(44011),u=s(27813),M=s(95093),g=s.n(M),E=s(99194),p=s(418),v=s(44015),b=s(32389),D=s(65606),w=class{constructor(e,t){(0,o.M)(this,"data",[]),(0,o.M)(this,"globalViewModel",null),(0,o.M)(this,"toRaw",(()=>this.data)),(0,o.M)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[E.sSJ.EVENT_NAME]===t[E.sSJ.EVENT_NAME]));e={...e,[t[E.sSJ.EVENT_NAME]]:s}})),e})),(0,o.M)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[E.HMX.EVENT_NAME]===t[E.HMX.EVENT_NAME]));e={...e,[t[E.HMX.EVENT_NAME]]:s}})),e})),(0,o.M)(this,"getFilterName",(()=>{const e=this.transformResponse(),t=Object.keys(e).map((e=>({value:e,label:e})));return t?.unshift({value:"all",label:"All"}),t})),(0,o.M)(this,"getListLine",(()=>{const e=this.transformResponse();return Object.keys(e).map((e=>e))})),(0,o.M)(this,"toAreaChart",(()=>{const e=this.transformEventsResponse(),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=(0,E.jgq)(this.globalViewModel.dateFilter.date_start,this.globalViewModel.dateFilter.date_end),a={},r={all:s.map((t=>({name:t&&g()(t,"YYYY-MM-DD").format("DD"),...Object.keys(e).map((s=>{const a=e[s].filter((e=>e[E.HMX.DATE]===t));return{[s]:a?.length?a[0][E.HMX.TOTAL_VISITOR]:0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((t=>({[t]:s.map((s=>{const a=e[t].filter((e=>e[E.HMX.DATE]===s));return{name:s&&g()(s,"YYYY-MM-DD").format("DD MMM"),[t]:a?.length?a[0][E.HMX.TOTAL_VISITOR]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})},n={all:t.map(((t,s)=>({name:t,...Object.keys(e).map((e=>{const t=this.data?.filter((e=>g()(e[E.HMX.DATE],"YYYY-MM-DD").month()===s))?.reduce(((e,t)=>e+t[E.HMX.TOTAL_VISITOR]),0);return{[e]:t??0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((e=>({[e]:t.map(((t,s)=>{const a=this.data?.filter((e=>g()(e[E.HMX.DATE],"YYYY-MM-DD").month()===s))?.reduce(((e,t)=>e+t[E.HMX.TOTAL_VISITOR]),0);return a?{name:t,[e]:a}:{name:t,[e]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})};s.forEach((t=>{const s=g()(t).startOf("isoWeek").format("YYYY-MM-DD"),r=g()(t).endOf("isoWeek").format("YYYY-MM-DD"),n=`${g()(s).format("DD MMM")} - ${g()(r).format("DD MMM")}`;a[n]||(a[n]={},Object.keys(e).forEach((e=>{a[n][e]=0}))),Object.keys(e).forEach((s=>{const r=e[s].filter((e=>e[E.HMX.DATE]===t));a[n][s]+=r?.length?r[0][E.HMX.TOTAL_VISITOR]:0}))}));return[n,r,{all:Object.keys(a).map((e=>({name:e,...a[e]})))}]})),(0,o.M)(this,"toBarChart",(()=>{const e=this.transformEventsResponse();return Object.keys(e).map((t=>({name:t,number:e[t]?.reduce(((e,t)=>e+t[E.HMX.TOTAL_VISITOR]),0)})))})),(0,o.M)(this,"handleChangeLink",((e,t)=>{e.preventDefault(),t&&this.globalViewModel.setIntegrationLink(t)})),(0,o.M)(this,"toEventTable",(e=>{const t=["Name","Type","URL","Referer","Date",""],s=[E.sSJ.EVENT_NAME,E.sSJ.EVENT_TYPE,E.sSJ.URL,E.sSJ.REFERER,E.sSJ.START_DATE,E.sSJ.UUID];if(this.data.length){const a=s.map(((s,a)=>({Header:t[a],accessor:s,width:s===E.sSJ.UUID?10:s===E.sSJ.EVENT_TYPE?50:170,allowSort:s===E.sSJ.START_DATE,Cell:({cell:t,column:s})=>{if(s.id===E.sSJ.EVENT_NAME&&t?.value)return h.createElement(h.Fragment,null,e?h.createElement("a",{href:"#",onClick:e=>this.handleChangeLink(e,`behavior-events&id=${t?.value}`),className:"px-3 text-secondary-50"},h.createElement("span",null,t?.value??null)):h.createElement(d.k2,{to:`/behavior/events/${t?.value}`,className:"px-3 text-secondary-50"},t?.value??null));if(s.id===E.sSJ.UUID)return h.createElement(h.Fragment,null);if(s.id!==E.sSJ.REFERER&&s.id!==E.sSJ.URL||!t?.value)return h.createElement("div",{className:"px-3"},t?.value??null);{const e=new URL(t?.value);return h.createElement("div",{className:"px-3"},""===e?"Unknown":e.pathname+e.search)}}}))),r=this.data.map((e=>({...e,...s.map((t=>t===E.sSJ.START_DATE?{[t]:g()(e[t]).format("DD-MM-YYYY HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})}))),n=r?.map((e=>{for(let t in e)s.includes(t)||delete e[t];return e}));return{header:a,data:n}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}},S=class{constructor(e,t){(0,o.M)(this,"eventsStore",null),(0,o.M)(this,"status",i.s.READY),(0,o.M)(this,"statusTable",i.s.READY),(0,o.M)(this,"globalStoreViewModel",null),(0,o.M)(this,"data",null),(0,o.M)(this,"dataEvents",null),(0,o.M)(this,"dataFilter",{}),(0,o.M)(this,"attributeData",null),(0,o.M)(this,"search",{}),(0,o.M)(this,"sortBy",{"sort[]":"","sort_direction[]":""}),(0,o.M)(this,"transformDataToEventsListModel",(()=>new w(this.data))),(0,o.M)(this,"getVisitor",(async(e,t,s={},a={})=>{this.statusTable=i.s.LOADING,this.sortBy=s,this.search=a,this.dataFilterTable={page_size:"5",...this.dataFilterTable,...e,...this.sortBy,...this.search};const r={...this.globalStoreViewModel.dateFilter,...t};await this.eventsStore.getVisitor(this.dataFilterTable,r,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,o.M)(this,"getEvents",((e,t)=>{this.status=i.s.LOADING,this.dataFilterEvents={page_size:"1000",...this.dataFilterEvents,...e};const s={...this.globalStoreViewModel.dateFilter,...t};this.eventsStore.getEvents(this.dataFilterEvents,s,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,o.M)(this,"getAttribute",((e,t)=>{this.status=i.s.LOADING,this.dataFilter={...this.dataFilter,...e};const s={...this.globalStoreViewModel?.dateFilter,...t};this.eventsStore.getAttribute(e,s,this.callbackOnDataAttributeSuccessHandler,this.callbackOnErrorHandler)})),(0,o.M)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,o.M)(this,"handleFilterDateRange",((e,t)=>{this.status=i.s.LOADING,this.statusTable=i.s.LOADING;const s={...this.globalStoreViewModel.dateFilter,date_start:g()(e).format("YYYY-MM-DD"),date_end:g()(t).endOf("day").format("YYYY-MM-DD")};this.dateFilter={...this.dateFilter,...s},this.eventsStore.getVisitor(this.dataFilterTable,s,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.eventsStore.getEvents(this.dataFilterEvents,s,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,o.M)(this,"handleFilterTable",(async e=>{this.statusTable=i.s.LOADING,this.dataFilterTable={...this.dataFilterTable,...e};const t={...this.globalStoreViewModel.dateFilter};if(await this.eventsStore.getVisitor(this.dataFilterTable,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.globalStoreViewModel.dataFilter={pagination:this.dataFilterTable?.page},e?.page){const t={...p.A.parse(location.search),pagination:e?.page};window.history.replaceState("","",`/behavior/events?${p.A.stringify(t)}`)}})),(0,o.M)(this,"callbackOnErrorHandler",(e=>{this.status=i.s.READY,(0,m.me)(e.message,"error")})),(0,o.M)(this,"callbackOnDataSuccessHandler",(e=>{if(e?.list){if("canceled"!==e?.message){this.statusTable=i.s.READY;const t=new w(e?.list,this.globalStoreViewModel);this.data={list:t,pagination:e.pagination}}}else this.statusTable=i.s.ERROR,this.data=[]})),(0,o.M)(this,"callbackOnDataEventsSuccessHandler",(e=>{if(e){if("canceled"!==e?.message){this.status=i.s.READY;const t=new w(e,this.globalStoreViewModel);this.dataEvents=t}}else this.status=i.s.ERROR,this.data=[]})),(0,o.M)(this,"callbackOnDataAttributeSuccessHandler",(e=>{e?"canceled"!==e?.message&&(this.status=i.s.READY,this.attributeData=e?.list):(this.status=i.s.ERROR,this.attributeData={})})),(0,u.l_)(this),this.eventsStore=e,this.globalStoreViewModel=t}},T=class{constructor(e,t){(0,o.M)(this,"eventsList",null),(0,o.M)(this,"getEventsListViewModel",(()=>this.eventsList)),e&&(this.eventsList=new S(e,t))}},f=(0,h.lazy)((()=>Promise.all([s.e(8921),s.e(450),s.e(304),s.e(889),s.e(2020)]).then(s.bind(s,62020)))),A=(0,h.lazy)((()=>s.e(4784).then(s.bind(s,34784)))),O=({link:e,...t})=>{switch(e){case"behavior-events":default:return h.createElement(f,{...t});case"behavior-events-generator":return h.createElement(A,{...t})}},R=(0,v.PA)(class extends h.Component{constructor(e){super(e),(0,o.M)(this,"eventsStore",null),(0,o.M)(this,"behaviorViewModel",null),(0,o.M)(this,"handleChangeLink",((e,t)=>{e.preventDefault(),t&&this.biListViewModel.setIntegrationLink(t)}));const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.eventsStore=new a.D({}),this.behaviorViewModel=new T(this.eventsStore,this.biListViewModel)}render(){const{integration:e=!1}=this.props,{integrationLink:t,activeDomain:s}=this.biListViewModel,a=(0,c.B6)(m.b6.location.pathname,{path:D.env.REACT_APP_INTERGRATION?"/bi":"/behavior/events",exact:!0,strict:!1});return h.createElement(r.g,{viewModel:this.behaviorViewModel},(a?.isExact||"behavior-events"===t)&&h.createElement("div",{className:"printButton d-flex"},e?h.createElement("a",{href:"#",onClick:e=>this.handleChangeLink(e,"behavior-events-generator"),className:"btn btn-success me-2 text-nowrap fw-semibold py-13 lh-sm"},h.createElement(b.wD,null,(e=>h.createElement(h.Fragment,null,e("txt_generator_event"))))):h.createElement(d.N_,{to:"/behavior/events-generator",className:"btn btn-success me-2 text-nowrap fw-semibold py-13 lh-sm"},h.createElement(b.wD,null,(e=>h.createElement(h.Fragment,null,e("txt_generator_event"))))),h.createElement(n.d,{data:this?.behaviorViewModel?.eventsList?.data?.list?.toEventTable(!0)?.data,i18n:this.props.i18n,t:this.props.t,componentRef:this.componentRef,classWrapper:!0,sectionName:"event"})),h.createElement(k,{integration:e,integrationLink:t,activeDomain:s,ref:e=>this.componentRef=e}))}}),k=(0,v.PA)(class extends h.Component{constructor(e){super(e)}render(){return h.createElement("div",{className:"aesirxui"},this.props.integration?h.createElement(O,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):h.createElement(h.Fragment,null,h.createElement(c.qh,{exact:!0,path:["/behavior/events","/bi/behavior/events"]},h.createElement(f,{...this.props})),h.createElement(c.qh,{exact:!0,path:["/behavior/events-generator"]},h.createElement(A,null))))}}),V=(0,b.CI)()((0,l.cm)((0,c.y)(R)))},5504:(e,t,s)=>{s.d(t,{D:()=>i});var a=s(81252),r=s(27813),n=s(99194),i=class{constructor(){(0,a.M)(this,"getVisitor",(async(e,t,s,a)=>{try{const i=new n.L20,l=await i.getVisitor(e,t);l&&"AxiosError"!==l?.name?(0,r.h5)((()=>{s(l)})):a({message:l?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.M)(this,"getAttribute",(async(e,t,s,a)=>{try{const i=new n.L20,l=await i.getAttribute(e,t);l&&"AxiosError"!==l?.name?(0,r.h5)((()=>{s(l)})):a({message:l?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.M)(this,"getEvents",(async(e,t,s,a)=>{try{const i=new n.L20,l=await i.getEvents(e,t);l&&"AxiosError"!==l?.name?(0,r.h5)((()=>{s(l)})):a({message:l?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}}},55270:(e,t,s)=>{s.d(t,{Z:()=>i,g:()=>n});var a=s(96540),r=a.createContext(),n=({children:e,viewModel:t})=>a.createElement(r.Provider,{value:t},e),i=()=>a.useContext(r)}}]);