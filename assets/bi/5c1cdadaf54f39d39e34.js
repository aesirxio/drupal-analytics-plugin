"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[4555],{14555:(e,t,s)=>{s.r(t),s.d(t,{default:()=>D});var a=s(5504),n=s(61985),l=s(51751),i=s(53800),r=s(81252),o=s(96540),c=s(44015),m=s(27813),d=s(99194),g=s(14630),h=s(95093),u=s.n(h),E=s(32389),w=s(56347),p=s(44354),f=s(20982),v=s(66188),N=s(418),S=o.createContext(),b=({children:e,viewModel:t})=>o.createElement(S.Provider,{value:t},e),M=class{constructor(){(0,r.M)(this,"getFlowDetail",(async(e,t,s,a)=>{try{const n=new d.L20,l=await n.getFlowDetail(e,t);l?(0,m.h5)((()=>{s(l)})):a({message:"Something went wrong from Server response"})}catch(e){(0,m.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},x=class{constructor(e,t){(0,r.M)(this,"data",[]),(0,r.M)(this,"globalViewModel",null),(0,r.M)(this,"toRaw",(()=>this.data)),(0,r.M)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[d.sSJ.EVENT_NAME]===t[d.sSJ.EVENT_NAME]));e={...e,[t[d.sSJ.EVENT_NAME]]:s}})),e})),(0,r.M)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[d.HMX.EVENT_NAME]===t[d.HMX.EVENT_NAME]));e={...e,[t[d.HMX.EVENT_NAME]]:s}})),e})),(0,r.M)(this,"toFlowDetailTable",(()=>{const e=["Name","Type","URL","Referer","Time (UTC)",""],t=[d.sSJ.EVENT_NAME,d.sSJ.EVENT_TYPE,d.sSJ.URL,d.sSJ.REFERER,d.sSJ.START_DATE,d.sSJ.UUID];if(this.data.length){const s=t.map(((t,s)=>({Header:e[s],accessor:t,width:t===d.sSJ.UUID?10:t===d.sSJ.EVENT_NAME||t===d.sSJ.EVENT_TYPE?80:170,allowSort:!0,Cell:({cell:e,column:t})=>{if(t.id===d.sSJ.EVENT_NAME&&e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);if(t.id===d.sSJ.UUID)return o.createElement(o.Fragment,null);if(t.id!==d.sSJ.REFERER&&t.id!==d.sSJ.URL||!e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);{const t=new URL(e?.value);let s=""===t?"Unknown":t.pathname+t.search;return o.createElement("a",{href:e?.value,rel:"noreferrer",target:"_blank",className:"px-3 d-block"},s?.length>53?s?.slice(0,53)+"...":s)}}}))),a=this.data.map((e=>({...e,...t.map((t=>t===d.sSJ.START_DATE?{[t]:u()(e[t])?.utc()?.format("HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})}))),n=a?.map((e=>{for(let s in e)t.includes(s)||delete e[s];return e}));return{header:s,data:n}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}},_=class{constructor(e,t,s){(0,r.M)(this,"flowStore",null),(0,r.M)(this,"behaviorStore",null),(0,r.M)(this,"status",l.s.READY),(0,r.M)(this,"globalStoreViewModel",null),(0,r.M)(this,"data",null),(0,r.M)(this,"relatedVisitorData",null),(0,r.M)(this,"dataFilter",{}),(0,r.M)(this,"getFlowDetail",((e,t)=>{this.status=l.s.LOADING,this.dataFilter={...this.dataFilter,...t},this.flowStore.getFlowDetail(e,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,r.M)(this,"callbackOnErrorHandler",(e=>{this.status=l.s.READY,(0,g.me)(e.message,"error")})),(0,r.M)(this,"callbackOnDataSuccessHandler",(e=>{if(e)if(this.status=l.s.READY,this.data=e,e?.events){const t=new x(e?.events,this.globalStoreViewModel);this.relatedVisitorData=t}else this.status=l.s.ERROR,this.relatedVisitorData=null;else this.status=l.s.ERROR,this.data={}})),(0,m.l_)(this),this.flowStore=e,this.behaviorStore=t,this.globalStoreViewModel=s}},k=class{constructor(e,t,s){(0,r.M)(this,"flowDetailViewModel",null),(0,r.M)(this,"getFlowViewModel",(()=>this.flowDetailViewModel)),t&&(this.flowDetailViewModel=new _(e,t,s))}},A=({data:e=[],loading:t=l.s.LOADING})=>o.createElement("div",{className:"row gx-24 mb-24"},e?.length>0?e.map(((e,s)=>o.createElement("div",{className:e.className,key:s},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},o.createElement("div",{className:"d-flex justify-content-between position-relative align-items-center"},t===l.s.LOADING?o.createElement(g.ee,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}):o.createElement(o.Fragment,null,o.createElement("div",{className:"overflow-hidden"},o.createElement("p",{className:"m-0 text-gray fs-16"},e.title),o.createElement("h3",{className:"mb-0 fw-semibold fs-4"},e?.value)),o.createElement("div",{className:"d-flex flex-wrap align-item-center"},o.createElement("div",{className:"icon-card rounded-circle ",style:{background:e?.iconColor&&(0,n.i)(e?.iconColor,.15)}},o.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${e?.icon})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:e?.iconColor&&(0,n.i)(e?.iconColor)}}))))))))):null),V=(0,c.PA)((e=>{const{t}=(0,E.Bd)(),{flowDetailViewModel:{data:s=[],relatedVisitorData:a,getFlowDetail:n,status:l}}=o.useContext(S),{biListViewModel:{activeDomain:r,dateFilter:c,dataFilter:m,integrationLink:h,setIntegrationLink:b}}=(0,i.jd)(),{uuid:M}=(0,w.g)(),x=N.A.parse(e.location.search),_=e.integration?h?.split("&id=")[1]?h?.split("&id=")[1]:x?.id:M;(0,o.useEffect)((()=>((async()=>{await n(_,{"with[]":"events"})})(),()=>{})),[r]);const k=(0,o.useMemo)((()=>[{className:"col-4",title:t("txt_domain"),icon:d._K2.PUBLIC_URL+"/assets/images/domain.svg",iconColor:"#1AB394",value:s?.[d.zSS.DOMAIN]??""},{className:"col-4",title:t("txt_duration"),icon:d._K2.PUBLIC_URL+"/assets/images/duration.png",iconColor:"#1AB394",value:u().utc(u().duration(u()(s?.[d.zSS.END]).diff(u()(s?.[d.zSS.START]))).asMilliseconds()).format("HH:mm:ss")??0},{className:"col-4",title:t("txt_actions"),icon:d._K2.PUBLIC_URL+"/assets/images/click.png",iconColor:"#1AB394",value:s?.[d.zSS.EVENTS]?.length??0}]),[s]),V=(0,o.useMemo)((()=>[{text:t("txt_date"),value:s?.[d.zSS.START]?u().utc(s?.[d.zSS.START]).format("DD/MM/YYYY hh:mm:ss"):""},{text:t("txt_domain"),value:s?.[d.zSS.DOMAIN]??""},{text:t("txt_locale"),value:s?.[d.zSS.LOCATION]?.country?.name??"unDetected"},{text:t("txt_ip"),value:s?.[d.zSS.IP]??""},{text:t("txt_device"),value:s?.[d.zSS.DEVICE]??""},{text:t("txt_browser"),value:s?.[d.zSS.BROWSER_NAME]??""}]),[s]);return o.createElement("div",{className:"py-4 px-4 h-100 d-flex flex-column"},o.createElement("div",{className:"position-relative d-flex align-items-center mb-3"},o.createElement("div",{className:"back_icon d-flex align-items-center justify-content-center cursor-pointer me-1",onClick:t=>{e.integration?((e,t)=>{e.preventDefault(),t&&b(t)})(t,"visitors-flow"):g.b6.push(`/visitors/flow?date_end=${c?.date_end}&date_start=${c?.date_start}&domain=${r}&pagination=${m?.pagination?m?.pagination:"1"}`)}},o.createElement(f.g,{className:"text-success",icon:v.Wzs})),o.createElement("h2",{className:"fw-bold mb-0"},t("txt_visitor_detail"))),o.createElement("div",{className:"row gx-24 "},o.createElement("div",{className:"col-3"},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3"},V?.length?V.map(((e,t)=>o.createElement("div",{key:t,className:`d-flex justify-content-between ${V.length-1===t?"":"mb-3"} `},o.createElement("span",null,e.text),o.createElement("span",null,e.value)))):null)),o.createElement("div",{className:"col-9"},o.createElement(A,{loading:l,data:k}),a?.data?.length?o.createElement("div",{className:"bg-white p-24"},a?.data?.map(((e,t)=>o.createElement("div",{className:"d-flex align-items-center mb-24 flow-detail-item",key:t},o.createElement("div",{className:"flow-detail-item-image me-10"},o.createElement(p.A,{className:"object-fit-contain",style:{width:32,height:32},src:`${d._K2.PUBLIC_URL}/assets/images/flow_icon.png`,alt:"icons"})),o.createElement("div",{className:"flow-detail-item-content d-flex flex-wrap"},o.createElement("div",{className:"fs-14 w-100",style:{color:"#5F5E70"}},u()(e[d.sSJ.START_DATE])?.utc()?.format("HH:mm:ss")),o.createElement("div",{className:"flow_detail_item_content_action text-white fw-medium d-inline-flex my-sm "+("visit"===e[d.sSJ.EVENT_NAME]?"text-capitalize":"")},"visit"===e[d.sSJ.EVENT_NAME]?"Visited":e[d.sSJ.EVENT_NAME]),o.createElement("div",{className:"w-100"},o.createElement("a",{href:`${e[d.sSJ.URL]}`,target:"_blank",rel:"noreferrer",className:"flow_detail_item_content_link fw-semibold"},e[d.sSJ.URL]))))))):o.createElement(o.Fragment,null))))})),y=(0,w.y)(V),R=(0,c.PA)(class extends o.Component{constructor(e){super(e),(0,r.M)(this,"flowStore",null),(0,r.M)(this,"flowViewModel",null),(0,r.M)(this,"eventsStore",null);const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.flowStore=new M({}),this.eventsStore=new a.D({}),this.flowViewModel=new k(this.flowStore,this.eventsStore,this.biListViewModel)}render(){return o.createElement(b,{viewModel:this.flowViewModel},o.createElement(y,{...this.props}))}}),D=(0,i.cm)((0,w.y)(R))},5504:(e,t,s)=>{s.d(t,{D:()=>i});var a=s(81252),n=s(27813),l=s(99194),i=class{constructor(){(0,a.M)(this,"getVisitor",(async(e,t,s,a)=>{try{const i=new l.L20,r=await i.getVisitor(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{s(r)})):a({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.M)(this,"getAttribute",(async(e,t,s,a)=>{try{const i=new l.L20,r=await i.getAttribute(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{s(r)})):a({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.M)(this,"getEvents",(async(e,t,s,a)=>{try{const i=new l.L20,r=await i.getEvents(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{s(r)})):a({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):e.response?.data.error?a({message:e.response?.data?.error}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}}},61985:(e,t,s)=>{s.d(t,{E:()=>o,i:()=>r});var a=s(51751),n=s(96540),l=s(14630),i=s(99194);document.head.appendChild(document.createElement("style")).appendChild(document.createTextNode("/*\n * @copyright   Copyright (C) 2022 AesirX. All rights reserved.\n * @license     GNU General Public License version 3, see LICENSE.\n */\n.icon-card {\n  width: 56px;\n  height: 56px;\n}\n.icon-card .icon {\n  width: 100%;\n  height: 100%;\n  background-color: var(--sidebar-menu-item-color);\n}\n\n.icon-grown {\n  width: 18px;\n  height: 18px;\n}"));function r(e,t){var s=parseInt(e.slice(1,3),16),a=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return t?"rgba("+s+", "+a+", "+n+", "+t+")":"rgb("+s+", "+a+", "+n+")"}var o=({title:e,icon:t,iconColor:s,value:o,isIncrease:c,percent:m,textPercent:d,options:g,defaultValue:h,loading:u})=>{const[E,w]=(0,n.useState)(h??null),[p,f]=(0,n.useState)(o);(0,n.useEffect)((()=>{let e=g?.find((e=>e?.value===E?.value));f(e?e?.actualValue:o)}),[o]);return n.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},n.createElement("div",{className:"d-flex justify-content-between align-items-center mb-16"},n.createElement("div",{className:"d-flex align-items-center position-relative"},t&&n.createElement("div",{className:"icon-card rounded-circle me-16 ",style:{background:r(s,.15)}},n.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${t})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:r(s)}})),n.createElement("h6",{className:"mb-0 fw-medium text-gray-900"},e)),g&&n.createElement(l.J0,{value:E,options:g,className:"fs-sm",isBorder:!0,onChange:e=>{w(e),e?.actualValue&&f(e?.actualValue)},isSearchable:!1})),n.createElement("div",{className:"d-flex justify-content-between position-relative"},u===a.s.LOADING&&n.createElement(l.ee,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}),n.createElement("h3",{className:"mb-0 fw-medium fs-24"},p),n.createElement("div",{className:"d-flex flex-wrap align-item-center"},m&&n.createElement("div",{className:"d-flex w-100 mb-sm justify-content-end"},n.createElement("span",{className:"icon-grown arrow d-inline-block align-text-bottom ms-auto text-primary "+(c?"bg-green":"bg-red"),style:{WebkitMaskImage:`url(${i._K2.PUBLIC_URL}${c?"/assets/images/grown-up.svg":"/assets/images/grown-down.svg"})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center"}}),n.createElement("span",{className:(c?"text-green":"text-danger")+" fw-semibold"},c?"+":"-",m)),n.createElement("div",{className:"w-100 text-gray fs-sm text-end"},d))))}},44354:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(46942),n=s.n(a),l=s(96540),i=s(5556),r=s.n(i),o=s(36519),c=s(74848);r().string,r().bool,r().bool,r().bool,r().bool;const m=l.forwardRef((({bsPrefix:e,className:t,fluid:s=!1,rounded:a=!1,roundedCircle:l=!1,thumbnail:i=!1,...r},m)=>(e=(0,o.oU)(e,"img"),(0,c.jsx)("img",{ref:m,...r,className:n()(t,s&&`${e}-fluid`,a&&"rounded",l&&"rounded-circle",i&&`${e}-thumbnail`)}))));m.displayName="Image";const d=m}}]);