"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[215],{57215:(t,e,a)=>{a.r(e),a.d(e,{default:()=>F});var s=a(93295),r=a(20513),i=a(70069),n=a(23541),l=a(67294),o=a(16550),c=a(68949),u=a(40872),m=a(38994),h=a(30381),d=a.n(h),g=a(73727),b=a(38585),p=a(47116),T=a.n(p),D=a(91072),M=a(34155),k=class{constructor(){(0,n.o)(this,"getVisitor",(async(t,e,a,s)=>{try{const r=new u.Q2,i=await r.getVisitor(t,e);i?(0,c.z)((()=>{a(i)})):s({message:"Something went wrong from Server response"})}catch(t){(0,c.z)((()=>{t.response?.data.message?s({message:t.response?.data?.message}):s({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,n.o)(this,"getAttribute",(async(t,e,a,s)=>{try{const r=new u.Q2,i=await r.getAttribute(t,e);i?(0,c.z)((()=>{a(i)})):s({message:"Something went wrong from Server response"})}catch(t){(0,c.z)((()=>{t.response?.data.message?s({message:t.response?.data?.message}):s({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,n.o)(this,"getAttributeDate",(async(t,e,a,s)=>{try{const r=new u.Q2,i=await r.getAttributeDate(t,e);i?(0,c.z)((()=>{a(i)})):s({message:"Something went wrong from Server response"})}catch(t){(0,c.z)((()=>{t.response?.data.message?s({message:t.response?.data?.message}):s({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},w=class{constructor(t,e){(0,n.o)(this,"data",null),(0,n.o)(this,"globalViewModel",null),(0,n.o)(this,"toRaw",(()=>this.data)),(0,n.o)(this,"handleChangeLink",((t,e)=>{t.preventDefault(),e&&this.globalViewModel.setIntegrationLink(e)})),(0,n.o)(this,"transformResponseUTM",(()=>{let t={};return this.data?.length>0&&this.data?.forEach((e=>{e.values?.forEach((e=>{const a=this.data.filter((t=>t?.values.some((t=>t?.value===e?.value))));t={...t,[e?.value]:a}}))})),t})),(0,n.o)(this,"getFilterNameUTM",(()=>{const t=this.transformResponseUTM(),e=Object.keys(t).map((t=>({value:t,label:t})));return e?.unshift({value:"all",label:"All"}),e})),(0,n.o)(this,"getListLineUTM",(()=>{const t=this.transformResponseUTM();return Object.keys(t).map((t=>t))})),(0,n.o)(this,"toBarChartUTM",(()=>{const t=this.transformResponseUTM();return Object.keys(t).map((e=>({name:e,number:t[e]?.map((t=>t?.values?.map((t=>t?.count))))?.reduce(((t,e)=>parseInt(t)+parseInt(e)),0)})))})),(0,n.o)(this,"toAreaChartUTM",(()=>{const t=this.transformResponseUTM(),e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=(0,u.F9)(this.globalViewModel.dateFilter.date_start,this.globalViewModel.dateFilter.date_end),s={all:a.map((e=>({name:e&&d()(e,"YYYY-MM-DD").format("MM-DD"),...Object.keys(t).map((a=>{const s=t[a]?.filter((t=>d()(t[u.zA.DATE]).format("YYYY-MM-DD")===e));return{[a]:s?.length?s[0]?.values?.find((t=>t?.value===a))?.count:0}})).reduce(((t,e)=>({...e,...t})),{})}))),...Object.keys(t).map((e=>({[e]:a.map((a=>{const s=t[e]?.filter((t=>d()(t[u.zA.DATE]).format("YYYY-MM-DD")===a));return{name:a&&d()(a,"YYYY-MM-DD").format("MM-DD"),[e]:s?.length?s[0]?.values?.find((t=>t?.value===e))?.count:0}}))}))).reduce(((t,e)=>({...e,...t})),{})};return[{all:e.map(((e,a)=>({name:e,...Object.keys(t).map((e=>{const s=t[e].filter((t=>d()(t[u.zA.DATE]).month()===a));return{[e]:s?.length?s[0]?.values?.find((t=>t?.value===e))?.count:0}})).reduce(((t,e)=>({...e,...t})),{})}))),...Object.keys(t).map((a=>({[a]:e.map(((e,s)=>{const r=t[a].filter((t=>d()(t[u.zA.DATE]).month()===s));return{name:e,[a]:r?.length?r[0]?.values?.find((t=>t?.value===a))?.count:0}}))}))).reduce(((t,e)=>({...e,...t})),{})},s]})),(0,n.o)(this,"toEventTableUTM",(t=>{const e=["Campaign ID","Campaign Source","Campaign Medium","Campaign Name","Campaign Term","Campaign Content","URL","Referer","Date"],a=[u.Gl.FLOW_ID,"utm_source","utm_medium","utm_campaign","utm_term","utm_content",u.Gl.URL,u.Gl.REFERER,u.Gl.START_DATE];if(this.data.length){const s=a.map(((a,s)=>({Header:e[s],accessor:a,Cell:({cell:e,column:a})=>{if(a.id===u.Gl.FLOW_ID&&e?.value){const a=this.data.find((t=>t?.[u.Gl.FLOW_ID]===e?.value));return l.createElement(l.Fragment,null,t?l.createElement("a",{href:"#",onClick:t=>this.handleChangeLink(t,`flow/${e?.value}`),className:"px-3"},l.createElement("span",null,a?.[u.Gl.ATTRIBUTES].find((t=>"utm_id"===t?.name))?.value)):l.createElement(g.OL,{to:`/flow/${e?.value}`,className:"px-3"},a?.[u.Gl.ATTRIBUTES].find((t=>"utm_id"===t?.name))?.value))}if(a.id!==u.Gl.REFERER&&a.id!==u.Gl.URL||!e?.value)return l.createElement("div",{className:"px-3"},e?.value??null);{const t=new URL(e?.value);return l.createElement("div",{className:"px-3"},""===t?"Unknown":t.pathname+t.search)}}}))),r=this.data.map((t=>{const e=t[u.Gl.ATTRIBUTES].map((t=>{if(a.includes(t.name))return{[t.name]:t.value}})).filter((t=>t)).reduce(((t,e)=>({...e,...t})),{});return Object.keys(e).length?a.map((a=>a===u.Gl.START_DATE?{[a]:d()(t[a]).format("DD-MM-YYYY HH:mm:ss")}:{[a]:t[a],...e})).reduce(((t,e)=>({...e,...t})),{}):null})).filter((t=>t));return r?.length&&r?.sort(((t,e)=>d()(e.start,"DD-MM-YYYY HH:mm:ss")-d()(t.start,"DD-MM-YYYY HH:mm:ss"))),{header:s,data:r}}return{header:[],data:[]}})),t&&(this.data=t,this.globalViewModel=e)}},E=class{constructor(t,e){(0,n.o)(this,"utmTrackingStore",null),(0,n.o)(this,"statusAttribute",r.r.READY),(0,n.o)(this,"statusTable",r.r.READY),(0,n.o)(this,"globalStoreViewModel",null),(0,n.o)(this,"data",null),(0,n.o)(this,"dataFilter",{}),(0,n.o)(this,"attributeData",null),(0,n.o)(this,"dataAttribute",null),(0,n.o)(this,"transformDataToUTMTrackingEventModel",(()=>new w(this.data))),(0,n.o)(this,"getVisitor",((t,e)=>{this.statusTable=r.r.LOADING,this.dataFilterTable={page_size:"5",...this.dataFilterTable,...t};const a={...this.globalStoreViewModel.dateFilter,...e};this.utmTrackingStore.getVisitor(this.dataFilterTable,a,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"getAttributeDate",((t,e)=>{this.statusAttribute=r.r.LOADING,this.dataFilterAttribute={page_size:"1000",...this.dataFilterAttribute,...t};const a={...this.globalStoreViewModel?.dateFilter,...e};this.utmTrackingStore.getAttributeDate(this.dataFilterAttribute,a,this.callbackOnDataAttributeSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"setDataFilter",(t=>{this.dataFilter=t})),(0,n.o)(this,"handleFilterDateRange",((t,e)=>{this.statusAttribute=r.r.LOADING,this.statusTable=r.r.LOADING;const a={...this.globalStoreViewModel.dateFilter,date_start:d()(t).format("YYYY-MM-DD"),date_end:d()(e).endOf("day").format("YYYY-MM-DD")};this.dateFilter={...this.dateFilter,...a},this.utmTrackingStore.getVisitor(this.dataFilterTable,a,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.utmTrackingStore.getAttributeDate(this.dataFilterAttribute,a,this.callbackOnDataAttributeSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"handleFilterTable",(async t=>{this.statusTable=r.r.LOADING,this.dataFilterTable={...this.dataFilterTable,...t};const e={...this.globalStoreViewModel.dateFilter};await this.utmTrackingStore.getVisitor(this.dataFilterTable,e,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"callbackOnErrorHandler",(t=>{this.statusAttribute=r.r.READY,this.statusTable=r.r.READY,(0,m.j5)(t.message,"error")})),(0,n.o)(this,"callbackOnDataSuccessHandler",(t=>{if(t?.list){this.statusTable=r.r.READY;const e=new w(t?.list,this.globalStoreViewModel);this.data={list:e,pagination:t.pagination}}else this.statusTable=r.r.ERROR,this.data=[]})),(0,n.o)(this,"callbackOnDataAttributeSuccessHandler",(t=>{if(t){this.statusAttribute=r.r.READY;const e=new w(t,this.globalStoreViewModel);this.dataAttribute=e}else this.statusAttribute=r.r.ERROR,this.data=[]})),(0,c.ky)(this),this.utmTrackingStore=t,this.globalStoreViewModel=e}},f=class{constructor(t,e){(0,n.o)(this,"utmTrackingEvents",null),(0,n.o)(this,"getUTMTrackingEventsViewModel",(()=>this.utmTrackingEvents)),t&&(this.utmTrackingEvents=new E(t,e))}},v=(0,l.lazy)((()=>Promise.all([a.e(689),a.e(93)]).then(a.bind(a,83093)))),A=(0,l.lazy)((()=>a.e(640).then(a.bind(a,53640)))),S=({link:t,...e})=>{switch(t){case"utm-tracking":default:return l.createElement(v,{...e});case"utm-tracking-generator":return l.createElement(A,{...e})}},Y=(0,b.Pi)(class extends l.Component{constructor(t){super(t),(0,n.o)(this,"utmTrackingStore",null),(0,n.o)(this,"utmTrackingViewModel",null);const{viewModel:e}=t;this.viewModel=e||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.utmTrackingStore=new k({}),this.utmTrackingViewModel=new f(this.utmTrackingStore,this.biListViewModel)}render(){const{integration:t=!1}=this.props,{integrationLink:e,activeDomain:a}=this.biListViewModel,r=(0,o.LX)(m.m8.location.pathname,{path:M.env.REACT_APP_INTERGRATION?"/bi":"/utm-tracking",exact:!0,strict:!1});return l.createElement(s.P,{viewModel:this.utmTrackingViewModel},(r?.isExact||"utm-tracking"===e)&&l.createElement(T(),{trigger:()=>l.createElement(D.Wb,null,((t,{i18n:e})=>l.createElement("a",{className:`btn btn-success me-2 text-nowrap fw-semibold py-16 lh-sm printButton ${e?.language}`,href:"#"},t("txt_export_pdf")))),content:()=>this.componentRef}),l.createElement(R,{integration:t,integrationLink:e,activeDomain:a,ref:t=>this.componentRef=t}))}}),R=(0,b.Pi)(class extends l.Component{constructor(t){super(t)}render(){return l.createElement(l.Fragment,null,this.props.integration?l.createElement(S,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):l.createElement(l.Fragment,null,l.createElement(o.AW,{exact:!0,path:["/utm-tracking","/bi/utm-tracking"]},l.createElement(v,null)),l.createElement(o.AW,{exact:!0,path:["/utm-tracking/generator","/bi/utm-tracking"]},l.createElement(A,null))))}}),F=(0,i.NQ)(Y)},93295:(t,e,a)=>{a.d(e,{C:()=>n,P:()=>i});var s=a(67294),r=s.createContext(),i=({children:t,viewModel:e})=>s.createElement(r.Provider,{value:e},t),n=()=>s.useContext(r)}}]);