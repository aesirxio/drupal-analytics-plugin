"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[7565],{57565:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var s=a(57257),l=a(30769),n=a(20513),r=a(70069),i=a(23541),o=a(67294),c=a(38585),m=a(68949),d=a(73022),g=a(26982),u=a(30381),h=a.n(u),E=a(91072),w=a(16550),p=a(41330),f=a(70982),v=a(59417),N=a(12086),b=o.createContext(),x=({children:e,viewModel:t})=>o.createElement(b.Provider,{value:t},e),_=class{constructor(){(0,i.o)(this,"getFlowDetail",(async(e,t,a,s)=>{try{const l=new d.Q22,n=await l.getFlowDetail(e,t);n?(0,m.z)((()=>{a(n)})):s({message:"Something went wrong from Server response"})}catch(e){(0,m.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},k=class{constructor(e,t){(0,i.o)(this,"data",[]),(0,i.o)(this,"globalViewModel",null),(0,i.o)(this,"toRaw",(()=>this.data)),(0,i.o)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[d.Gl6.EVENT_NAME]===t[d.Gl6.EVENT_NAME]));e={...e,[t[d.Gl6.EVENT_NAME]]:a}})),e})),(0,i.o)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[d.oZZ.EVENT_NAME]===t[d.oZZ.EVENT_NAME]));e={...e,[t[d.oZZ.EVENT_NAME]]:a}})),e})),(0,i.o)(this,"toFlowDetailTable",(()=>{const e=["Name","Type","URL","Referer","Time (UTC)",""],t=[d.Gl6.EVENT_NAME,d.Gl6.EVENT_TYPE,d.Gl6.URL,d.Gl6.REFERER,d.Gl6.START_DATE,d.Gl6.UUID];if(this.data.length){const a=t.map(((t,a)=>({Header:e[a],accessor:t,width:t===d.Gl6.UUID?10:t===d.Gl6.EVENT_NAME||t===d.Gl6.EVENT_TYPE?80:170,allowSort:!0,Cell:({cell:e,column:t})=>{if(t.id===d.Gl6.EVENT_NAME&&e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);if(t.id===d.Gl6.UUID)return o.createElement(o.Fragment,null);if(t.id!==d.Gl6.REFERER&&t.id!==d.Gl6.URL||!e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);{const t=new URL(e?.value);let a=""===t?"Unknown":t.pathname+t.search;return o.createElement("a",{href:e?.value,rel:"noreferrer",target:"_blank",className:"px-3 d-block"},a?.length>53?a?.slice(0,53)+"...":a)}}}))),s=this.data.map((e=>({...e,...t.map((t=>t===d.Gl6.START_DATE?{[t]:h()(e[t])?.utc()?.format("HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})}))),l=s?.map((e=>{for(let a in e)t.includes(a)||delete e[a];return e}));return{header:a,data:l}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}},y=class{constructor(e,t,a){(0,i.o)(this,"flowStore",null),(0,i.o)(this,"behaviorStore",null),(0,i.o)(this,"status",n.r.READY),(0,i.o)(this,"globalStoreViewModel",null),(0,i.o)(this,"data",null),(0,i.o)(this,"relatedVisitorData",null),(0,i.o)(this,"dataFilter",{}),(0,i.o)(this,"getFlowDetail",((e,t)=>{this.status=n.r.LOADING,this.dataFilter={...this.dataFilter,...t},this.flowStore.getFlowDetail(e,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,i.o)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,i.o)(this,"callbackOnErrorHandler",(e=>{this.status=n.r.READY,(0,g.j5)(e.message,"error")})),(0,i.o)(this,"callbackOnDataSuccessHandler",(e=>{if(e)if(this.status=n.r.READY,this.data=e,e?.events){const t=new k(e?.events,this.globalStoreViewModel);this.relatedVisitorData=t}else this.status=n.r.ERROR,this.relatedVisitorData=null;else this.status=n.r.ERROR,this.data={}})),(0,m.ky)(this),this.flowStore=e,this.behaviorStore=t,this.globalStoreViewModel=a}},M=class{constructor(e,t,a){(0,i.o)(this,"flowDetailViewModel",null),(0,i.o)(this,"getFlowViewModel",(()=>this.flowDetailViewModel)),t&&(this.flowDetailViewModel=new y(e,t,a))}},S=({data:e=[],loading:t=n.r.LOADING})=>o.createElement("div",{className:"row gx-24 mb-24"},e?.length>0?e.map(((e,a)=>o.createElement("div",{className:e.className,key:a},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},o.createElement("div",{className:"d-flex justify-content-between position-relative align-items-center"},t===n.r.LOADING?o.createElement(g.DC,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}):o.createElement(o.Fragment,null,o.createElement("div",{className:"overflow-hidden"},o.createElement("p",{className:"m-0 text-gray fs-16"},e.title),o.createElement("h3",{className:"mb-0 fw-semibold fs-4"},e?.value)),o.createElement("div",{className:"d-flex flex-wrap align-item-center"},o.createElement("div",{className:"icon-card rounded-circle ",style:{background:e?.iconColor&&(0,l.$)(e?.iconColor,.15)}},o.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${e?.icon})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:e?.iconColor&&(0,l.$)(e?.iconColor)}}))))))))):null),V=(0,c.Pi)((e=>{const{t}=(0,E.$G)(),{flowDetailViewModel:{data:a=[],relatedVisitorData:s,getFlowDetail:l,status:n}}=o.useContext(b),{biListViewModel:{activeDomain:i,dateFilter:c,dataFilter:m,integrationLink:u,setIntegrationLink:x}}=(0,r.mQ)(),{uuid:_}=(0,w.UO)(),k=N.Z.parse(e.location.search),y=e.integration?u?.split("&id=")[1]?u?.split("&id=")[1]:k?.id:_;(0,o.useEffect)((()=>((async()=>{await l(y,{"with[]":"events"})})(),()=>{})),[i]);const M=(0,o.useMemo)((()=>[{className:"col-4",title:t("txt_domain"),icon:d.OBj.PUBLIC_URL+"/assets/images/domain.svg",iconColor:"#1AB394",value:a?.[d.ykq.DOMAIN]??""},{className:"col-4",title:t("txt_duration"),icon:d.OBj.PUBLIC_URL+"/assets/images/duration.png",iconColor:"#1AB394",value:h().utc(h().duration(h()(a?.[d.ykq.END]).diff(h()(a?.[d.ykq.START]))).asMilliseconds()).format("HH:mm:ss")??0},{className:"col-4",title:t("txt_actions"),icon:d.OBj.PUBLIC_URL+"/assets/images/click.png",iconColor:"#1AB394",value:a?.[d.ykq.EVENTS]?.length??0}]),[a]),V=(0,o.useMemo)((()=>[{text:t("txt_date"),value:a?.[d.ykq.START]?h().utc(a?.[d.ykq.START]).format("DD/MM/YYYY hh:mm:ss"):""},{text:t("txt_domain"),value:a?.[d.ykq.DOMAIN]??""},{text:t("txt_locale"),value:a?.[d.ykq.LOCATION]?.country?.name??"unDetected"},{text:t("txt_ip"),value:a?.[d.ykq.IP]??""},{text:t("txt_device"),value:a?.[d.ykq.DEVICE]??""},{text:t("txt_browser"),value:a?.[d.ykq.BROWSER_NAME]??""}]),[a]);return o.createElement("div",{className:"py-4 px-4 h-100 d-flex flex-column"},o.createElement("div",{className:"position-relative d-flex align-items-center mb-3"},o.createElement("div",{className:"back_icon d-flex align-items-center justify-content-center cursor-pointer me-1",onClick:t=>{e.integration?((e,t)=>{e.preventDefault(),t&&x(t)})(t,"visitors-flow"):g.m8.push(`/visitors/flow?date_end=${c?.date_end}&date_start=${c?.date_start}&domain=${i}&pagination=${m?.pagination?m?.pagination:"1"}`)}},o.createElement(f.G,{className:"text-success",icon:v.A35})),o.createElement("h2",{className:"fw-bold mb-0"},t("txt_visitor_detail"))),o.createElement("div",{className:"row gx-24 "},o.createElement("div",{className:"col-3"},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3"},V?.length?V.map(((e,t)=>o.createElement("div",{key:t,className:`d-flex justify-content-between ${V.length-1===t?"":"mb-3"} `},o.createElement("span",null,e.text),o.createElement("span",null,e.value)))):null)),o.createElement("div",{className:"col-9"},o.createElement(S,{loading:n,data:M}),s?.data?.length?o.createElement("div",{className:"bg-white p-24"},s?.data?.map(((e,t)=>o.createElement("div",{className:"d-flex align-items-center mb-24 flow-detail-item",key:t},o.createElement("div",{className:"flow-detail-item-image me-10"},o.createElement(p.Z,{className:"object-fit-contain",style:{width:32,height:32},src:`${d.OBj.PUBLIC_URL}/assets/images/flow_icon.png`,alt:"icons"})),o.createElement("div",{className:"flow-detail-item-content d-flex flex-wrap"},o.createElement("div",{className:"fs-14 w-100",style:{color:"#5F5E70"}},h()(e[d.Gl6.START_DATE])?.utc()?.format("HH:mm:ss")),o.createElement("div",{className:"flow_detail_item_content_action text-white fw-medium d-inline-flex my-sm "+("visit"===e[d.Gl6.EVENT_NAME]?"text-capitalize":"")},"visit"===e[d.Gl6.EVENT_NAME]?"Visited":e[d.Gl6.EVENT_NAME]),o.createElement("div",{className:"w-100"},o.createElement("a",{href:`${e[d.Gl6.URL]}`,target:"_blank",rel:"noreferrer",className:"flow_detail_item_content_link fw-semibold"},e[d.Gl6.URL]))))))):o.createElement(o.Fragment,null))))})),A=(0,w.EN)(V),R=(0,c.Pi)(class extends o.Component{constructor(e){super(e),(0,i.o)(this,"flowStore",null),(0,i.o)(this,"flowViewModel",null),(0,i.o)(this,"eventsStore",null);const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.flowStore=new _({}),this.eventsStore=new s.i({}),this.flowViewModel=new M(this.flowStore,this.eventsStore,this.biListViewModel)}render(){return o.createElement(x,{viewModel:this.flowViewModel},o.createElement(A,{...this.props}))}}),D=(0,r.NQ)((0,w.EN)(R))},57257:(e,t,a)=>{a.d(t,{i:()=>r});var s=a(23541),l=a(68949),n=a(73022),r=class{constructor(){(0,s.o)(this,"getVisitor",(async(e,t,a,s)=>{try{const r=new n.Q22,i=await r.getVisitor(e,t);i&&"AxiosError"!==i?.name?(0,l.z)((()=>{a(i)})):s({message:i?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,l.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.o)(this,"getAttribute",(async(e,t,a,s)=>{try{const r=new n.Q22,i=await r.getAttribute(e,t);i&&"AxiosError"!==i?.name?(0,l.z)((()=>{a(i)})):s({message:i?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,l.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.o)(this,"getEvents",(async(e,t,a,s)=>{try{const r=new n.Q22,i=await r.getEvents(e,t);i&&"AxiosError"!==i?.name?(0,l.z)((()=>{a(i)})):s({message:i?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,l.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}}},30769:(e,t,a)=>{a.d(t,{$:()=>i,T:()=>o});var s=a(20513),l=a(67294),n=a(26982),r=a(73022);document.head.appendChild(document.createElement("style")).appendChild(document.createTextNode("/*\n * @copyright   Copyright (C) 2022 AesirX. All rights reserved.\n * @license     GNU General Public License version 3, see LICENSE.\n */\n.icon-card {\n  width: 56px;\n  height: 56px;\n}\n.icon-card .icon {\n  width: 100%;\n  height: 100%;\n  background-color: var(--sidebar-menu-item-color);\n}\n\n.icon-grown {\n  width: 18px;\n  height: 18px;\n}"));function i(e,t){var a=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16);return t?"rgba("+a+", "+s+", "+l+", "+t+")":"rgb("+a+", "+s+", "+l+")"}var o=({title:e,icon:t,iconColor:a,value:o,isIncrease:c,percent:m,textPercent:d,options:g,defaultValue:u,loading:h})=>{const[E,w]=(0,l.useState)(u??null),[p,f]=(0,l.useState)(o);(0,l.useEffect)((()=>{let e=g?.find((e=>e?.value===E?.value));f(e?e?.actualValue:o)}),[o]);return l.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},l.createElement("div",{className:"d-flex justify-content-between align-items-center mb-16"},l.createElement("div",{className:"d-flex align-items-center position-relative"},t&&l.createElement("div",{className:"icon-card rounded-circle me-16 ",style:{background:i(a,.15)}},l.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${t})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:i(a)}})),l.createElement("h6",{className:"mb-0 fw-medium text-gray-900"},e)),g&&l.createElement(n.nW,{value:E,options:g,className:"fs-sm",isBorder:!0,onChange:e=>{w(e),e?.actualValue&&f(e?.actualValue)},isSearchable:!1})),l.createElement("div",{className:"d-flex justify-content-between position-relative"},h===s.r.LOADING&&l.createElement(n.DC,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}),l.createElement("h3",{className:"mb-0 fw-medium fs-24"},p),l.createElement("div",{className:"d-flex flex-wrap align-item-center"},m&&l.createElement("div",{className:"d-flex w-100 mb-sm justify-content-end"},l.createElement("span",{className:"icon-grown arrow d-inline-block align-text-bottom ms-auto text-primary "+(c?"bg-green":"bg-red"),style:{WebkitMaskImage:`url(${r.OBj.PUBLIC_URL}${c?"/assets/images/grown-up.svg":"/assets/images/grown-down.svg"})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center"}}),l.createElement("span",{className:(c?"text-green":"text-danger")+" fw-semibold"},c?"+":"-",m)),l.createElement("div",{className:"w-100 text-gray fs-sm text-end"},d))))}},41330:(e,t,a)=>{a.d(t,{Z:()=>d});var s=a(94184),l=a.n(s),n=a(67294),r=a(45697),i=a.n(r),o=a(76792),c=a(48521);i().string,i().bool,i().bool,i().bool,i().bool;const m=n.forwardRef((({bsPrefix:e,className:t,fluid:a=!1,rounded:s=!1,roundedCircle:n=!1,thumbnail:r=!1,...i},m)=>(e=(0,o.vE)(e,"img"),(0,c.jsx)("img",{ref:m,...i,className:l()(t,a&&`${e}-fluid`,s&&"rounded",n&&"rounded-circle",r&&`${e}-thumbnail`)}))));m.displayName="Image";const d=m}}]);