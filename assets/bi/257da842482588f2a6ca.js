"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[3243],{73243:(e,t,a)=>{a.r(t),a.d(t,{default:()=>V});var s=a(57257),r=a(77989),n=a(65925),i=a(20513),o=a(70069),l=a(23541),h=a(67294),c=a(16550),d=a(73727),m=a(26982),u=a(68949),g=a(30381),E=a.n(g),p=a(73022),v=a(12086),b=a(38585),D=a(91072),M=a(34155),w=class{constructor(e,t){(0,l.o)(this,"data",[]),(0,l.o)(this,"globalViewModel",null),(0,l.o)(this,"toRaw",(()=>this.data)),(0,l.o)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[p.Gl6.EVENT_NAME]===t[p.Gl6.EVENT_NAME]));e={...e,[t[p.Gl6.EVENT_NAME]]:a}})),e})),(0,l.o)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[p.oZZ.EVENT_NAME]===t[p.oZZ.EVENT_NAME]));e={...e,[t[p.oZZ.EVENT_NAME]]:a}})),e})),(0,l.o)(this,"getFilterName",(()=>{const e=this.transformResponse(),t=Object.keys(e).map((e=>({value:e,label:e})));return t?.unshift({value:"all",label:"All"}),t})),(0,l.o)(this,"getListLine",(()=>{const e=this.transformResponse();return Object.keys(e).map((e=>e))})),(0,l.o)(this,"toAreaChart",(()=>{const e=this.transformEventsResponse(),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=(0,p.F9f)(this.globalViewModel.dateFilter.date_start,this.globalViewModel.dateFilter.date_end),s={},r={all:a.map((t=>({name:t&&E()(t,"YYYY-MM-DD").format("DD MMM"),...Object.keys(e).map((a=>{const s=e[a].filter((e=>e[p.oZZ.DATE]===t));return{[a]:s?.length?s[0][p.oZZ.TOTAL_VISITOR]:0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((t=>({[t]:a.map((a=>{const s=e[t].filter((e=>e[p.oZZ.DATE]===a));return{name:a&&E()(a,"YYYY-MM-DD").format("DD MMM"),[t]:s?.length?s[0][p.oZZ.TOTAL_VISITOR]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})},n={all:t.map(((t,a)=>({name:t,...Object.keys(e).map((e=>{const t=this.data?.filter((e=>E()(e[p.oZZ.DATE],"YYYY-MM-DD").month()===a))?.reduce(((e,t)=>e+t[p.oZZ.TOTAL_VISITOR]),0);return{[e]:t??0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((e=>({[e]:t.map(((t,a)=>{const s=this.data?.filter((e=>E()(e[p.oZZ.DATE],"YYYY-MM-DD").month()===a))?.reduce(((e,t)=>e+t[p.oZZ.TOTAL_VISITOR]),0);return s?{name:t,[e]:s}:{name:t,[e]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})};a.forEach((t=>{const a=E()(t).startOf("isoWeek").format("YYYY-MM-DD"),r=E()(t).endOf("isoWeek").format("YYYY-MM-DD"),n=`${E()(a).format("DD MMM")} - ${E()(r).format("DD MMM")}`;s[n]||(s[n]={},Object.keys(e).forEach((e=>{s[n][e]=0}))),Object.keys(e).forEach((a=>{const r=e[a].filter((e=>e[p.oZZ.DATE]===t));s[n][a]+=r?.length?r[0][p.oZZ.TOTAL_VISITOR]:0}))}));return[n,r,{all:Object.keys(s).map((e=>({name:e,...s[e]})))}]})),(0,l.o)(this,"toBarChart",(()=>{const e=this.transformEventsResponse();return Object.keys(e).map((t=>({name:t,number:e[t]?.reduce(((e,t)=>e+t[p.oZZ.TOTAL_VISITOR]),0)})))})),(0,l.o)(this,"handleChangeLink",((e,t)=>{e.preventDefault(),t&&this.globalViewModel.setIntegrationLink(t)})),(0,l.o)(this,"toEventTable",(e=>{const t=["Name","Type","URL","Referer","Date",""],a=[p.Gl6.EVENT_NAME,p.Gl6.EVENT_TYPE,p.Gl6.URL,p.Gl6.REFERER,p.Gl6.START_DATE,p.Gl6.UUID];if(this.data.length){const s=a.map(((a,s)=>({Header:t[s],accessor:a,width:a===p.Gl6.UUID?10:170,allowSort:a===p.Gl6.START_DATE,Cell:({cell:t,column:a})=>{if(a.id===p.Gl6.EVENT_NAME&&t?.value)return h.createElement(h.Fragment,null,e?h.createElement("a",{href:"#",onClick:e=>this.handleChangeLink(e,`behavior-events&id=${t?.value}`),className:"px-3 text-secondary-50"},h.createElement("span",null,t?.value??null)):h.createElement(d.OL,{to:`/behavior/events/${t?.value}`,className:"px-3 text-secondary-50"},t?.value??null));if(a.id===p.Gl6.UUID)return h.createElement(h.Fragment,null);if(a.id!==p.Gl6.REFERER&&a.id!==p.Gl6.URL||!t?.value)return h.createElement("div",{className:"px-3"},t?.value??null);{const e=new URL(t?.value);return h.createElement("div",{className:"px-3"},""===e?"Unknown":e.pathname+e.search)}}}))),r=this.data.map((e=>({...e,...a.map((t=>t===p.Gl6.START_DATE?{[t]:E()(e[t]).format("DD-MM-YYYY HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})}))),n=r?.map((e=>{for(let t in e)a.includes(t)||delete e[t];return e}));return{header:s,data:n}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}},f=class{constructor(e,t){(0,l.o)(this,"eventsStore",null),(0,l.o)(this,"status",i.r.READY),(0,l.o)(this,"statusTable",i.r.READY),(0,l.o)(this,"globalStoreViewModel",null),(0,l.o)(this,"data",null),(0,l.o)(this,"dataEvents",null),(0,l.o)(this,"dataFilter",{}),(0,l.o)(this,"attributeData",null),(0,l.o)(this,"search",{}),(0,l.o)(this,"sortBy",{"sort[]":"","sort_direction[]":""}),(0,l.o)(this,"transformDataToEventsListModel",(()=>new w(this.data))),(0,l.o)(this,"getVisitor",(async(e,t,a={},s={})=>{this.statusTable=i.r.LOADING,this.sortBy=a,this.search=s,this.dataFilterTable={page_size:"5",...this.dataFilterTable,...e,...this.sortBy,...this.search};const r={...this.globalStoreViewModel.dateFilter,...t};await this.eventsStore.getVisitor(this.dataFilterTable,r,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"getEvents",((e,t)=>{this.status=i.r.LOADING,this.dataFilterEvents={page_size:"1000",...this.dataFilterEvents,...e};const a={...this.globalStoreViewModel.dateFilter,...t};this.eventsStore.getEvents(this.dataFilterEvents,a,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"getAttribute",((e,t)=>{this.status=i.r.LOADING,this.dataFilter={...this.dataFilter,...e};const a={...this.globalStoreViewModel?.dateFilter,...t};this.eventsStore.getAttribute(e,a,this.callbackOnDataAttributeSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,l.o)(this,"handleFilterDateRange",((e,t)=>{this.status=i.r.LOADING,this.statusTable=i.r.LOADING;const a={...this.globalStoreViewModel.dateFilter,date_start:E()(e).format("YYYY-MM-DD"),date_end:E()(t).endOf("day").format("YYYY-MM-DD")};this.dateFilter={...this.dateFilter,...a},this.eventsStore.getVisitor(this.dataFilterTable,a,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.eventsStore.getEvents(this.dataFilterEvents,a,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"handleFilterTable",(async e=>{this.statusTable=i.r.LOADING,this.dataFilterTable={...this.dataFilterTable,...e};const t={...this.globalStoreViewModel.dateFilter};if(await this.eventsStore.getVisitor(this.dataFilterTable,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.globalStoreViewModel.dataFilter={pagination:this.dataFilterTable?.page},e?.page){const t={...v.Z.parse(location.search),pagination:e?.page};window.history.replaceState("","",`/behavior/events?${v.Z.stringify(t)}`)}})),(0,l.o)(this,"callbackOnErrorHandler",(e=>{this.status=i.r.READY,(0,m.j5)(e.message,"error")})),(0,l.o)(this,"callbackOnDataSuccessHandler",(e=>{if(e?.list){if("canceled"!==e?.message){this.statusTable=i.r.READY;const t=new w(e?.list,this.globalStoreViewModel);this.data={list:t,pagination:e.pagination}}}else this.statusTable=i.r.ERROR,this.data=[]})),(0,l.o)(this,"callbackOnDataEventsSuccessHandler",(e=>{if(e){if("canceled"!==e?.message){this.status=i.r.READY;const t=new w(e,this.globalStoreViewModel);this.dataEvents=t}}else this.status=i.r.ERROR,this.data=[]})),(0,l.o)(this,"callbackOnDataAttributeSuccessHandler",(e=>{e?"canceled"!==e?.message&&(this.status=i.r.READY,this.attributeData=e?.list):(this.status=i.r.ERROR,this.attributeData={})})),(0,u.ky)(this),this.eventsStore=e,this.globalStoreViewModel=t}},T=class{constructor(e,t){(0,l.o)(this,"eventsList",null),(0,l.o)(this,"getEventsListViewModel",(()=>this.eventsList)),e&&(this.eventsList=new f(e,t))}},A=(0,h.lazy)((()=>Promise.all([a.e(7398),a.e(1744),a.e(6656),a.e(8032),a.e(2514)]).then(a.bind(a,72514)))),S=(0,h.lazy)((()=>a.e(361).then(a.bind(a,60361)))),O=({link:e,...t})=>{switch(e){case"behavior-events":default:return h.createElement(A,{...t});case"behavior-events-generator":return h.createElement(S,{...t})}},R=(0,b.Pi)(class extends h.Component{constructor(e){super(e),(0,l.o)(this,"eventsStore",null),(0,l.o)(this,"behaviorViewModel",null),(0,l.o)(this,"handleChangeLink",((e,t)=>{e.preventDefault(),t&&this.biListViewModel.setIntegrationLink(t)}));const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.eventsStore=new s.i({}),this.behaviorViewModel=new T(this.eventsStore,this.biListViewModel)}render(){const{integration:e=!1}=this.props,{integrationLink:t,activeDomain:a}=this.biListViewModel,s=(0,c.LX)(m.m8.location.pathname,{path:M.env.REACT_APP_INTERGRATION?"/bi":"/behavior/events",exact:!0,strict:!1});return h.createElement(r.e,{viewModel:this.behaviorViewModel},(s?.isExact||"behavior-events"===t)&&h.createElement("div",{className:"printButton d-flex"},e?h.createElement("a",{href:"#",onClick:e=>this.handleChangeLink(e,"behavior-events-generator"),className:"btn btn-success me-2 text-nowrap fw-semibold py-13 lh-sm"},h.createElement(D.Wb,null,(e=>h.createElement(h.Fragment,null,e("txt_generator_event"))))):h.createElement(d.rU,{to:"/behavior/events-generator",className:"btn btn-success me-2 text-nowrap fw-semibold py-13 lh-sm"},h.createElement(D.Wb,null,(e=>h.createElement(h.Fragment,null,e("txt_generator_event"))))),h.createElement(n.V,{data:this?.behaviorViewModel?.eventsList?.data?.list?.toEventTable(!0)?.data,i18n:this.props.i18n,t:this.props.t,componentRef:this.componentRef,classWrapper:!0,sectionName:"event"})),h.createElement(k,{integration:e,integrationLink:t,activeDomain:a,ref:e=>this.componentRef=e}))}}),k=(0,b.Pi)(class extends h.Component{constructor(e){super(e)}render(){return h.createElement("div",{className:"aesirxui"},this.props.integration?h.createElement(O,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):h.createElement(h.Fragment,null,h.createElement(c.AW,{exact:!0,path:["/behavior/events","/bi/behavior/events"]},h.createElement(A,{...this.props})),h.createElement(c.AW,{exact:!0,path:["/behavior/events-generator"]},h.createElement(S,null))))}}),V=(0,D.Zh)()((0,o.NQ)((0,c.EN)(R)))},57257:(e,t,a)=>{a.d(t,{i:()=>i});var s=a(23541),r=a(68949),n=a(73022),i=class{constructor(){(0,s.o)(this,"getVisitor",(async(e,t,a,s)=>{try{const i=new n.Q22,o=await i.getVisitor(e,t);o&&"AxiosError"!==o?.name?(0,r.z)((()=>{a(o)})):s({message:o?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.o)(this,"getAttribute",(async(e,t,a,s)=>{try{const i=new n.Q22,o=await i.getAttribute(e,t);o&&"AxiosError"!==o?.name?(0,r.z)((()=>{a(o)})):s({message:o?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.o)(this,"getEvents",(async(e,t,a,s)=>{try{const i=new n.Q22,o=await i.getEvents(e,t);o&&"AxiosError"!==o?.name?(0,r.z)((()=>{a(o)})):s({message:o?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}}},77989:(e,t,a)=>{a.d(t,{c:()=>i,e:()=>n});var s=a(67294),r=s.createContext(),n=({children:e,viewModel:t})=>s.createElement(r.Provider,{value:t},e),i=()=>s.useContext(r)}}]);