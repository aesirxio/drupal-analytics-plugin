"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[7318],{57318:(t,e,s)=>{s.r(e),s.d(e,{default:()=>S});var i=s(23518),a=s(25854),o=s(65925),l=s(20513),r=s(70069),n=s(23541),c=s(67294),h=s(91072),d=s(38585),w=s(16550),u=s(68949),m=s(73022),L=s(26982),p=s(30381),g=s.n(p),f=s(12086),E=class{constructor(){(0,n.o)(this,"getFlowList",(async(t,e,s,i)=>{try{const a=new m.Q22,o=await a.getFlowList(t,e);o&&"AxiosError"!==o?.name?(0,u.z)((()=>{s(o)})):i({message:o?.response?.data?.error||"Something went wrong from Server response"})}catch(t){(0,u.z)((()=>{t.response?.data.message?i({message:t.response?.data?.message}):i({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},v=class{constructor(t,e){(0,n.o)(this,"countriesStore",null),(0,n.o)(this,"status",l.r.READY),(0,n.o)(this,"globalStoreViewModel",null),(0,n.o)(this,"countriesTableData",null),(0,n.o)(this,"sortBy",{"sort[]":"","sort_direction[]":""}),(0,n.o)(this,"dataFilterFlowList",{}),(0,n.o)(this,"initialize",((t,e)=>{this.getFlowList(t,e)})),(0,n.o)(this,"getFlowList",((t,e,s={"sort[]":"start","sort_direction[]":"desc"})=>{this.status=l.r.LOADING,this.sortBy=s,this.dataFilter={page_size:"20",...this.dataFilter,...t,...this.sortBy};const i={...this.globalStoreViewModel.dateFilter,...e};this.countriesStore.getFlowList(this.dataFilter,i,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"handleFilter",(t=>{this.status=l.r.LOADING,this.dataFilter={...this.dataFilter,...t};const e={...this.globalStoreViewModel.dateFilter};this.countriesStore.getFlowList(this.dataFilter,e,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler)})),(0,n.o)(this,"handleFilterDateRange",((t,e)=>{this.status=l.r.LOADING;let s={date_start:g()(t).format("YYYY-MM-DD"),date_end:g()(e).endOf("day").format("YYYY-MM-DD")};this.initialize(this.dataFilter,s)})),(0,n.o)(this,"handleFilterFlowList",(async t=>{const e=L.m8.location;this.status=l.r.LOADING,this.dataFilterFlowList={...this.dataFilter,...t},this.globalStoreViewModel.dataFilter={pagination:this.dataFilterFlowList?.page};const s={...this.globalStoreViewModel.dateFilter};if(await this.countriesStore.getFlowList(this.dataFilterFlowList,s,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler),t?.page){const s={...f.Z.parse(e.search),pagination:t?.page};window.history.replaceState("","",`/visitors/flow?${f.Z.stringify(s)}`)}})),(0,n.o)(this,"callbackOnErrorHandler",(t=>{this.status=l.r.READY,(0,L.j5)(t.message,"error")})),(0,n.o)(this,"callbackOnCountriesSuccessHandler",(t=>{if(t){if("canceled"!==t?.message&&"isCancle"!==t?.message){this.status=l.r.READY;const e=new a.L(t.list,this.globalStoreViewModel);this.countriesTableData={list:e,pagination:t.pagination}}}else this.status=l.r.ERROR,this.data=[]})),(0,u.ky)(this),this.countriesStore=t,this.globalStoreViewModel=e}},M=class{constructor(t,e){(0,n.o)(this,"flowListListViewModel",null),(0,n.o)(this,"getFlowListListViewModel",(()=>this.flowListListViewModel)),t&&(this.flowListListViewModel=new v(t,e))}},G=(0,c.lazy)((()=>Promise.all([s.e(868),s.e(8195)]).then(s.bind(s,98195)))),H=({link:t,...e})=>{if("visitors-flow"===t)return c.createElement(G,{...e})},b=(0,d.Pi)(class extends c.Component{constructor(t){super(t),(0,n.o)(this,"flowListStore",null),(0,n.o)(this,"flowListViewModel",null),(0,n.o)(this,"componentDidMount",(()=>{this.props.integration||"/"!==L.m8.location.pathname||L.m8.push(`${this.biListViewModel.activeDomain}`)}));const{viewModel:e}=t;this.viewModel=e||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.flowListStore=new E,this.flowListViewModel=new M(this.flowListStore,this.biListViewModel)}render(){const{integration:t=!1}=this.props,{integrationLink:e,activeDomain:s}=this.biListViewModel;return c.createElement(i.U,{viewModel:this.flowListViewModel},c.createElement(o.V,{data:this?.flowListViewModel?.flowListListViewModel?.countriesTableData?.list?.data,i18n:this.props.i18n,t:this.props.t,componentRef:this.componentRef,sectionName:"location"}),c.createElement(F,{ref:t=>this.componentRef=t,integration:t,integrationLink:e,activeDomain:s}))}}),F=(0,d.Pi)(class extends c.Component{constructor(t){super(t)}render(){return c.createElement("div",{className:"aesirxui"},this.props.integration?c.createElement(H,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):c.createElement(c.Fragment,null,c.createElement(w.AW,{exact:!0,path:["/visitors/flow","/bi/visitors/flow"]},c.createElement(G,{...this.props}))))}}),S=(0,h.Zh)()((0,w.EN)((0,r.NQ)(b)))},25854:(t,e,s)=>{s.d(e,{L:()=>c});var i=s(23541),a=s(67294),o=s(73022),l=s(30381),r=s.n(l),n=s(73727),c=class{constructor(t,e){(0,i.o)(this,"data",[]),(0,i.o)(this,"globalViewModel",null),(0,i.o)(this,"toRaw",(()=>this.data)),(0,i.o)(this,"handleChangeLink",((t,e)=>{t.preventDefault(),e&&this.globalViewModel.setIntegrationLink(e)})),(0,i.o)(this,"toFlowListTable",(t=>{const e=["txt_time_utc","txt_locale","txt_sop_id","txt_event","txt_conversion","txt_url",""],s=[o.GLH.START,o.GLH.GEO,o.GLH.SOP_ID,o.GLH.EVENT,o.GLH.CONVERSION,o.GLH.URL,o.GLH.UUID];if(this.data?.length){const i=s.map(((s,i)=>({Header:e[i],accessor:s,width:s===o.GLH.START?100:s===o.GLH.SOP_ID?40:s===o.GLH.EVENT||s===o.GLH.CONVERSION||s===o.GLH.GEO?30:s===o.GLH.URL?230:s===o.GLH.UUID?80:170,allowSort:s!==o.GLH.EVENT&&s!==o.GLH.CONVERSION&&s!==o.GLH.URL&&s!==o.GLH.SOP_ID&&s!==o.GLH.GEO,Cell:({cell:e,column:s,row:i})=>{if(s.id===o.GLH.GEO)return a.createElement("div",{className:"px-3"},""===e?.value?a.createElement(a.Fragment,null):a.createElement("span",{className:`me-1 fi fi-${this.data.find((t=>t[o.GLH.GEO]?.country?.code===i?.values[o.GLH.GEO]?.country?.code))?.[o.GLH.GEO]?.country?.code?.toLowerCase()}`}),a.createElement("span",{className:"text-nowrap"},""===e?.value?"Unknown":""));if(s.id===o.GLH.UUID)return a.createElement(a.Fragment,null,t?a.createElement("a",{href:"#",onClick:t=>this.handleChangeLink(t,`flow&id=${e?.value}`),className:"btn btn-light px-3 py-1 fs-sm"},a.createElement("span",null," View Detail")):a.createElement(n.OL,{to:`/flow/${e?.value}`,className:"btn btn-light px-3 py-1 fs-sm"},"View Detail"));if(s.id===o.GLH.URL&&e?.value){const t=new URL(e?.value);let s=""===t?"Unknown":t.pathname+t.search;return a.createElement("a",{href:e?.value,target:"_blank",rel:"noreferrer",className:"px-3 d-inline-block text-secondary-50"},s?.length>53?s?.slice(0,53)+"...":s)}return s.id===o.GLH.START?a.createElement("div",{className:"px-3"},r()(e?.value)?.utc()?.format("DD-MM-YYYY HH:mm:ss")):a.createElement("div",{className:"px-3"},e?.value)}}))),l=this.data?.map((t=>({...t,...s.map((e=>({[e]:t[e]}))).reduce(((t,e)=>({...e,...t})),{})}))),c=l?.map((t=>{for(let e in t)s.includes(e)||delete t[e];return t}));return{header:i,data:c}}return{header:[],data:[]}})),t&&(this.data=t??[],this.globalViewModel=e)}}},23518:(t,e,s)=>{s.d(e,{U:()=>o,w:()=>l});var i=s(67294),a=i.createContext(),o=({children:t,viewModel:e})=>i.createElement(a.Provider,{value:e},t),l=t=>e=>i.createElement(t,{...e,viewModel:i.useContext(a)})}}]);