"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[320],{38320:(e,t,s)=>{s.r(t),s.d(t,{default:()=>O});var a=s(77989),r=s(17204),n=s(20513),i=s(70069),l=s(23541),o=s(67294),h=s(16550),c=s(38994),d=s(68949),m=s(30381),u=s.n(m),g=s(38585),E=s(47116),b=s.n(E),p=s(91072),v=s(34155),w=class{constructor(e,t){(0,l.o)(this,"eventsStore",null),(0,l.o)(this,"status",n.r.READY),(0,l.o)(this,"statusTable",n.r.READY),(0,l.o)(this,"globalStoreViewModel",null),(0,l.o)(this,"data",null),(0,l.o)(this,"dataEvents",null),(0,l.o)(this,"dataFilter",{}),(0,l.o)(this,"attributeData",null),(0,l.o)(this,"transformDataToEventsListModel",(()=>new r.I(this.data))),(0,l.o)(this,"getVisitor",((e,t)=>{this.statusTable=n.r.LOADING,this.dataFilterTable={page_size:"5","sort[]":"number_of_page_views","sort_direction[]":"desc",...this.dataFilterTable,...e};const s={...this.globalStoreViewModel.dateFilter,...t};this.eventsStore.getVisitor(this.dataFilterTable,s,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"getEvents",((e,t)=>{this.status=n.r.LOADING,this.dataFilterEvents={page_size:"1000",...this.dataFilterEvents,...e};const s={...this.globalStoreViewModel.dateFilter,...t};this.eventsStore.getEvents(this.dataFilterEvents,s,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"getAttribute",((e,t)=>{this.status=n.r.LOADING,this.dataFilter={...this.dataFilter,...e};const s={...this.globalStoreViewModel?.dateFilter,...t};this.eventsStore.getAttribute(e,s,this.callbackOnDataAttributeSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,l.o)(this,"handleFilterDateRange",((e,t)=>{this.status=n.r.LOADING,this.statusTable=n.r.LOADING;const s={...this.globalStoreViewModel.dateFilter,date_start:u()(e).format("YYYY-MM-DD"),date_end:u()(t).endOf("day").format("YYYY-MM-DD")};this.dateFilter={...this.dateFilter,...s},this.eventsStore.getVisitor(this.dataFilterTable,s,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler),this.eventsStore.getEvents(this.dataFilterEvents,s,this.callbackOnDataEventsSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"handleFilterTable",(async e=>{this.statusTable=n.r.LOADING,this.dataFilterTable={...this.dataFilterTable,...e};const t={...this.globalStoreViewModel.dateFilter};await this.eventsStore.getVisitor(this.dataFilterTable,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,l.o)(this,"callbackOnErrorHandler",(e=>{this.status=n.r.READY,(0,c.j5)(e.message,"error")})),(0,l.o)(this,"callbackOnDataSuccessHandler",(e=>{if(e?.list){this.statusTable=n.r.READY;const t=new r.I(e?.list,this.globalStoreViewModel);this.data={list:t,pagination:e.pagination}}else this.statusTable=n.r.ERROR,this.data=[]})),(0,l.o)(this,"callbackOnDataEventsSuccessHandler",(e=>{if(e){this.status=n.r.READY;const t=new r.I(e,this.globalStoreViewModel);this.dataEvents=t}else this.status=n.r.ERROR,this.data=[]})),(0,l.o)(this,"callbackOnDataAttributeSuccessHandler",(e=>{e?(this.status=n.r.READY,this.attributeData=e):(this.status=n.r.ERROR,this.attributeData={})})),(0,d.ky)(this),this.eventsStore=e,this.globalStoreViewModel=t}},D=class{constructor(e,t){(0,l.o)(this,"eventsList",null),(0,l.o)(this,"getEventsListViewModel",(()=>this.eventsList)),e&&(this.eventsList=new w(e,t))}},M=(0,o.lazy)((()=>Promise.all([s.e(689),s.e(542)]).then(s.bind(s,47542)))),T=(0,o.lazy)((()=>s.e(608).then(s.bind(s,60608)))),f=({link:e,...t})=>{switch(e){case"events":default:return o.createElement(M,{...t});case"events-generator":return o.createElement(T,{...t})}},S=(0,g.Pi)(class extends o.Component{constructor(e){super(e),(0,l.o)(this,"eventsStore",null),(0,l.o)(this,"behaviorViewModel",null);const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.eventsStore=new r.i({}),this.behaviorViewModel=new D(this.eventsStore,this.biListViewModel)}render(){const{integration:e=!1}=this.props,{integrationLink:t,activeDomain:s}=this.biListViewModel,r=(0,h.LX)(c.m8.location.pathname,{path:v.env.REACT_APP_INTERGRATION?"/bi":"/events",exact:!0,strict:!1});return o.createElement(a.e,{viewModel:this.behaviorViewModel},(r?.isExact||"events"===t)&&o.createElement(b(),{trigger:()=>o.createElement(p.Wb,null,((e,{i18n:t})=>o.createElement("a",{className:`btn btn-success me-2 text-nowrap fw-semibold py-16 lh-sm printButton ${t?.language}`,href:"#"},e("txt_export_pdf")))),content:()=>this.componentRef}),o.createElement(A,{integration:e,integrationLink:t,activeDomain:s,ref:e=>this.componentRef=e}))}}),A=(0,g.Pi)(class extends o.Component{constructor(e){super(e)}render(){return o.createElement(o.Fragment,null,this.props.integration?o.createElement(f,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):o.createElement(o.Fragment,null,o.createElement(h.AW,{exact:!0,path:["/events","/bi/events"]},o.createElement(M,null)),o.createElement(h.AW,{exact:!0,path:["/events/generator"]},o.createElement(T,null))))}}),O=(0,i.NQ)(S)},17204:(e,t,s)=>{s.d(t,{I:()=>d,i:()=>c});var a=s(23541),r=s(68949),n=s(40872),i=s(67294),l=s(30381),o=s.n(l),h=s(73727),c=class{constructor(){(0,a.o)(this,"getVisitor",(async(e,t,s,a)=>{try{const i=new n.Q2,l=await i.getVisitor(e,t);l?(0,r.z)((()=>{s(l)})):a({message:"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.o)(this,"getAttribute",(async(e,t,s,a)=>{try{const i=new n.Q2,l=await i.getAttribute(e,t);l?(0,r.z)((()=>{s(l)})):a({message:"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,a.o)(this,"getEvents",(async(e,t,s,a)=>{try{const i=new n.Q2,l=await i.getEvents(e,t);l?(0,r.z)((()=>{s(l)})):a({message:"Something went wrong from Server response"})}catch(e){(0,r.z)((()=>{e.response?.data.message?a({message:e.response?.data?.message}):a({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},d=class{constructor(e,t){(0,a.o)(this,"data",[]),(0,a.o)(this,"globalViewModel",null),(0,a.o)(this,"toRaw",(()=>this.data)),(0,a.o)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[n.Gl.EVENT_NAME]===t[n.Gl.EVENT_NAME]));e={...e,[t[n.Gl.EVENT_NAME]]:s}})),e})),(0,a.o)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const s=this.data.filter((e=>e[n.oZ.EVENT_NAME]===t[n.oZ.EVENT_NAME]));e={...e,[t[n.oZ.EVENT_NAME]]:s}})),e})),(0,a.o)(this,"getFilterName",(()=>{const e=this.transformResponse(),t=Object.keys(e).map((e=>({value:e,label:e})));return t?.unshift({value:"all",label:"All"}),t})),(0,a.o)(this,"getListLine",(()=>{const e=this.transformResponse();return Object.keys(e).map((e=>e))})),(0,a.o)(this,"toAreaChart",(()=>{const e=this.transformEventsResponse(),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=(0,n.F9)(this.globalViewModel.dateFilter.date_start,this.globalViewModel.dateFilter.date_end),a={all:s.map((t=>({name:t&&o()(t,"YYYY-MM-DD").format("MM-DD"),...Object.keys(e).map((s=>{const a=e[s].filter((e=>e[n.oZ.DATE]===t));return{[s]:a?.length?a[0][n.oZ.TOTAL_VISITOR]:0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((t=>({[t]:s.map((s=>{const a=e[t].filter((e=>e[n.oZ.DATE]===s));return{name:s&&o()(s,"YYYY-MM-DD").format("MM-DD"),[t]:a?.length?a[0][n.oZ.TOTAL_VISITOR]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})};return[{all:t.map(((t,s)=>({name:t,...Object.keys(e).map((e=>{const t=this.data?.filter((e=>o()(e[n.oZ.DATE],"YYYY-MM-DD").month()===s))?.reduce(((e,t)=>e+t[n.oZ.TOTAL_VISITOR]),0);return{[e]:t??0}})).reduce(((e,t)=>({...t,...e})),{})}))),...Object.keys(e).map((e=>({[e]:t.map(((t,s)=>{const a=this.data?.filter((e=>o()(e[n.oZ.DATE],"YYYY-MM-DD").month()===s))?.reduce(((e,t)=>e+t[n.oZ.TOTAL_VISITOR]),0);return a?{name:t,[e]:a}:{name:t,[e]:0}}))}))).reduce(((e,t)=>({...t,...e})),{})},a]})),(0,a.o)(this,"toBarChart",(()=>{const e=this.transformEventsResponse();return Object.keys(e).map((t=>({name:t,number:e[t]?.reduce(((e,t)=>e+t[n.oZ.TOTAL_VISITOR]),0)})))})),(0,a.o)(this,"handleChangeLink",((e,t)=>{e.preventDefault(),t&&this.globalViewModel.setIntegrationLink(t)})),(0,a.o)(this,"toEventTable",(e=>{const t=["Name","Type","URL","Referer","Date"],s=[n.Gl.EVENT_NAME,n.Gl.EVENT_TYPE,n.Gl.URL,n.Gl.REFERER,n.Gl.START_DATE];if(this.data.length){const a=s.map(((s,a)=>({Header:t[a],accessor:s,Cell:({cell:t,column:s,row:a})=>{if(s.id===n.Gl.EVENT_NAME&&t?.value)return i.createElement(i.Fragment,null,e?i.createElement("a",{href:"#",onClick:e=>this.handleChangeLink(e,`flow/${a.original?.[n.Gl.FLOW_ID]}`),className:"px-3"},i.createElement("span",null,t?.value)):i.createElement(h.OL,{to:`/flow/${a.original?.[n.Gl.FLOW_ID]}`,className:"px-3"},t?.value));if(s.id!==n.Gl.REFERER&&s.id!==n.Gl.URL||!t?.value)return i.createElement("div",{className:"px-3"},t?.value??null);{const e=new URL(t?.value);return i.createElement("div",{className:"px-3"},""===e?"Unknown":e.pathname+e.search)}}}))),r=this.data.map((e=>({...e,...s.map((t=>t===n.Gl.START_DATE?{[t]:o()(e[t]).format("DD-MM-YYYY HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})})));return r?.length&&r?.sort(((e,t)=>o()(t.start,"DD-MM-YYYY HH:mm:ss")-o()(e.start,"DD-MM-YYYY HH:mm:ss"))),{header:a,data:r}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}}},77989:(e,t,s)=>{s.d(t,{c:()=>i,e:()=>n});var a=s(67294),r=a.createContext(),n=({children:e,viewModel:t})=>a.createElement(r.Provider,{value:t},e),i=()=>a.useContext(r)}}]);