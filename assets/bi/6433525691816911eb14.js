"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[3137],{3137:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var s=a(5504),n=a(94380),l=a(51751),i=a(53800),r=a(81252),o=a(96540),c=a(44015),m=a(27813),d=a(99194),g=a(44011),h=a(95093),u=a.n(h),E=a(32389),w=a(56347),p=a(44354),f=a(20982),v=a(66188),N=a(418),S=o.createContext(),b=({children:e,viewModel:t})=>o.createElement(S.Provider,{value:t},e),M=class{constructor(){(0,r.M)(this,"getFlowDetail",(async(e,t,a,s)=>{try{const n=new d.L20,l=await n.getFlowDetail(e,t);l?(0,m.h5)((()=>{a(l)})):s({message:"Something went wrong from Server response"})}catch(e){(0,m.h5)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},x=class{constructor(e,t){(0,r.M)(this,"data",[]),(0,r.M)(this,"globalViewModel",null),(0,r.M)(this,"toRaw",(()=>this.data)),(0,r.M)(this,"transformResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[d.sSJ.EVENT_NAME]===t[d.sSJ.EVENT_NAME]));e={...e,[t[d.sSJ.EVENT_NAME]]:a}})),e})),(0,r.M)(this,"transformEventsResponse",(()=>{let e={};return this.data?.length>0&&this.data?.forEach((t=>{const a=this.data.filter((e=>e[d.HMX.EVENT_NAME]===t[d.HMX.EVENT_NAME]));e={...e,[t[d.HMX.EVENT_NAME]]:a}})),e})),(0,r.M)(this,"toFlowDetailTable",(()=>{const e=["Name","Type","URL","Referer","Time (UTC)",""],t=[d.sSJ.EVENT_NAME,d.sSJ.EVENT_TYPE,d.sSJ.URL,d.sSJ.REFERER,d.sSJ.START_DATE,d.sSJ.UUID];if(this.data.length){const a=t.map(((t,a)=>({Header:e[a],accessor:t,width:t===d.sSJ.UUID?10:t===d.sSJ.EVENT_NAME||t===d.sSJ.EVENT_TYPE?80:170,allowSort:!0,Cell:({cell:e,column:t})=>{if(t.id===d.sSJ.EVENT_NAME&&e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);if(t.id===d.sSJ.UUID)return o.createElement(o.Fragment,null);if(t.id!==d.sSJ.REFERER&&t.id!==d.sSJ.URL||!e?.value)return o.createElement("div",{className:"px-3"},e?.value??null);{const t=new URL(e?.value);let a=""===t?"Unknown":t.pathname+t.search;return o.createElement("a",{href:e?.value,rel:"noreferrer",target:"_blank",className:"px-3 d-block"},a?.length>53?a?.slice(0,53)+"...":a)}}}))),s=this.data.map((e=>({...e,...t.map((t=>t===d.sSJ.START_DATE?{[t]:u()(e[t])?.utc()?.format("HH:mm:ss")}:{[t]:e[t]})).reduce(((e,t)=>({...t,...e})),{})}))),n=s?.map((e=>{for(let a in e)t.includes(a)||delete e[a];return e}));return{header:a,data:n}}return{header:[],data:[]}})),e&&(this.data=e,this.globalViewModel=t)}},_=class{constructor(e,t,a){(0,r.M)(this,"flowStore",null),(0,r.M)(this,"behaviorStore",null),(0,r.M)(this,"status",l.s.READY),(0,r.M)(this,"globalStoreViewModel",null),(0,r.M)(this,"data",null),(0,r.M)(this,"relatedVisitorData",null),(0,r.M)(this,"dataFilter",{}),(0,r.M)(this,"getFlowDetail",((e,t)=>{this.status=l.s.LOADING,this.dataFilter={...this.dataFilter,...t},this.flowStore.getFlowDetail(e,t,this.callbackOnDataSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"setDataFilter",(e=>{this.dataFilter=e})),(0,r.M)(this,"callbackOnErrorHandler",(e=>{this.status=l.s.READY,(0,g.me)(e.message,"error")})),(0,r.M)(this,"callbackOnDataSuccessHandler",(e=>{if(e)if(this.status=l.s.READY,this.data=e,e?.events){const t=new x(e?.events,this.globalStoreViewModel);this.relatedVisitorData=t}else this.status=l.s.ERROR,this.relatedVisitorData=null;else this.status=l.s.ERROR,this.data={}})),(0,m.l_)(this),this.flowStore=e,this.behaviorStore=t,this.globalStoreViewModel=a}},A=class{constructor(e,t,a){(0,r.M)(this,"flowDetailViewModel",null),(0,r.M)(this,"getFlowViewModel",(()=>this.flowDetailViewModel)),t&&(this.flowDetailViewModel=new _(e,t,a))}},k=({data:e=[],loading:t=l.s.LOADING})=>o.createElement("div",{className:"row gx-24 mb-24"},e?.length>0?e.map(((e,a)=>o.createElement("div",{className:e.className,key:a},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},o.createElement("div",{className:"d-flex justify-content-between position-relative align-items-center"},t===l.s.LOADING?o.createElement(g.ee,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}):o.createElement(o.Fragment,null,o.createElement("div",{className:"overflow-hidden"},o.createElement("p",{className:"m-0 text-gray fs-16"},e.title),o.createElement("h3",{className:"mb-0 fw-semibold fs-4"},e?.value)),o.createElement("div",{className:"d-flex flex-wrap align-item-center"},o.createElement("div",{className:"icon-card rounded-circle ",style:{background:e?.iconColor&&(0,n.i)(e?.iconColor,.15)}},o.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${e?.icon})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:e?.iconColor&&(0,n.i)(e?.iconColor)}}))))))))):null),V=(0,c.PA)((e=>{const{t}=(0,E.Bd)(),{flowDetailViewModel:{data:a=[],relatedVisitorData:s,getFlowDetail:n,status:l}}=o.useContext(S),{biListViewModel:{activeDomain:r,dateFilter:c,dataFilter:m,integrationLink:h,setIntegrationLink:b}}=(0,i.jd)(),{uuid:M}=(0,w.g)(),x=N.A.parse(e.location.search),_=e.integration?h?.split("&id=")[1]?h?.split("&id=")[1]:x?.id:M;(0,o.useEffect)((()=>((async()=>{await n(_,{"with[]":"events"})})(),()=>{})),[r]);const A=(0,o.useMemo)((()=>[{className:"col-4",title:t("txt_domain"),icon:d._K2.PUBLIC_URL+"/assets/images/domain.svg",iconColor:"#1AB394",value:a?.[d.zSS.DOMAIN]??""},{className:"col-4",title:t("txt_duration"),icon:d._K2.PUBLIC_URL+"/assets/images/duration.png",iconColor:"#1AB394",value:u().utc(u().duration(u()(a?.[d.zSS.END]).diff(u()(a?.[d.zSS.START]))).asMilliseconds()).format("HH:mm:ss")??0},{className:"col-4",title:t("txt_actions"),icon:d._K2.PUBLIC_URL+"/assets/images/click.png",iconColor:"#1AB394",value:a?.[d.zSS.EVENTS]?.length??0}]),[a]),V=(0,o.useMemo)((()=>[{text:t("txt_date"),value:a?.[d.zSS.START]?u().utc(a?.[d.zSS.START]).format("DD/MM/YYYY hh:mm:ss"):""},{text:t("txt_domain"),value:a?.[d.zSS.DOMAIN]??""},{text:t("txt_locale"),value:a?.[d.zSS.LOCATION]?.country?.name??"unDetected"},{text:t("txt_ip"),value:a?.[d.zSS.IP]??""},{text:t("txt_device"),value:a?.[d.zSS.DEVICE]??""},{text:t("txt_browser"),value:a?.[d.zSS.BROWSER_NAME]??""}]),[a]);return o.createElement("div",{className:"py-4 px-4 h-100 d-flex flex-column"},o.createElement("div",{className:"position-relative d-flex align-items-center mb-3"},o.createElement("div",{className:"back_icon d-flex align-items-center justify-content-center cursor-pointer me-1",onClick:t=>{e.integration?((e,t)=>{e.preventDefault(),t&&b(t)})(t,"visitors-flow"):g.b6.push(`/visitors/flow?date_end=${c?.date_end}&date_start=${c?.date_start}&domain=${r}&pagination=${m?.pagination?m?.pagination:"1"}`)}},o.createElement(f.g,{className:"text-success",icon:v.Wzs})),o.createElement("h2",{className:"fw-bold mb-0"},t("txt_visitor_detail"))),o.createElement("div",{className:"row gx-24 "},o.createElement("div",{className:"col-3"},o.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3"},V?.length?V.map(((e,t)=>o.createElement("div",{key:t,className:`d-flex justify-content-between ${V.length-1===t?"":"mb-3"} `},o.createElement("span",null,e.text),o.createElement("span",null,e.value)))):null)),o.createElement("div",{className:"col-9"},o.createElement(k,{loading:l,data:A}),s?.data?.length?o.createElement("div",{className:"bg-white p-24"},s?.data?.map(((e,t)=>o.createElement("div",{className:"d-flex align-items-center mb-24 flow-detail-item",key:t},o.createElement("div",{className:"flow-detail-item-image me-10"},o.createElement(p.A,{className:"object-fit-contain",style:{width:32,height:32},src:`${d._K2.PUBLIC_URL}/assets/images/flow_icon.png`,alt:"icons"})),o.createElement("div",{className:"flow-detail-item-content d-flex flex-wrap"},o.createElement("div",{className:"fs-14 w-100",style:{color:"#5F5E70"}},u()(e[d.sSJ.START_DATE])?.utc()?.format("HH:mm:ss")),o.createElement("div",{className:"flow_detail_item_content_action text-white fw-medium d-inline-flex my-sm "+("visit"===e[d.sSJ.EVENT_NAME]?"text-capitalize":"")},"visit"===e[d.sSJ.EVENT_NAME]?"Visited":e[d.sSJ.EVENT_NAME]),o.createElement("div",{className:"w-100"},o.createElement("a",{href:`${e[d.sSJ.URL]}`,target:"_blank",rel:"noreferrer",className:"flow_detail_item_content_link fw-semibold"},e[d.sSJ.URL]))))))):o.createElement(o.Fragment,null))))})),y=(0,w.y)(V),R=(0,c.PA)(class extends o.Component{constructor(e){super(e),(0,r.M)(this,"flowStore",null),(0,r.M)(this,"flowViewModel",null),(0,r.M)(this,"eventsStore",null);const{viewModel:t}=e;this.viewModel=t||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.flowStore=new M({}),this.eventsStore=new s.D({}),this.flowViewModel=new A(this.flowStore,this.eventsStore,this.biListViewModel)}render(){return o.createElement(b,{viewModel:this.flowViewModel},o.createElement(y,{...this.props}))}}),D=(0,i.cm)((0,w.y)(R))},5504:(e,t,a)=>{a.d(t,{D:()=>i});var s=a(81252),n=a(27813),l=a(99194),i=class{constructor(){(0,s.M)(this,"getVisitor",(async(e,t,a,s)=>{try{const i=new l.L20,r=await i.getVisitor(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{a(r)})):s({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.M)(this,"getAttribute",(async(e,t,a,s)=>{try{const i=new l.L20,r=await i.getAttribute(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{a(r)})):s({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}})),(0,s.M)(this,"getEvents",(async(e,t,a,s)=>{try{const i=new l.L20,r=await i.getEvents(e,t);r&&"AxiosError"!==r?.name?(0,n.h5)((()=>{a(r)})):s({message:r?.response?.data?.error||"Something went wrong from Server response"})}catch(e){(0,n.h5)((()=>{e.response?.data.message?s({message:e.response?.data?.message}):e.response?.data.error?s({message:e.response?.data?.error}):s({message:e?.response?.data?._messages?e.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}}},94380:(e,t,a)=>{a.d(t,{E:()=>d,i:()=>m});var s=a(51751),n=a(96540),l=a(44011),i=a(99194),r=a(20982),o=a(66188),c=a(23524);document.head.appendChild(document.createElement("style")).appendChild(document.createTextNode("/*\n * @copyright   Copyright (C) 2022 AesirX. All rights reserved.\n * @license     GNU General Public License version 3, see LICENSE.\n */\n.icon-card {\n  width: 56px;\n  height: 56px;\n}\n.icon-card .icon {\n  width: 100%;\n  height: 100%;\n  background-color: var(--sidebar-menu-item-color);\n}\n\n.icon-grown {\n  width: 18px;\n  height: 18px;\n}"));function m(e,t){var a=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return t?"rgba("+a+", "+s+", "+n+", "+t+")":"rgb("+a+", "+s+", "+n+")"}var d=({title:e,icon:t,iconColor:a,value:d,isIncrease:g,percent:h,textPercent:u,options:E,defaultValue:w,loading:p,tooltip:f})=>{const[v,N]=(0,n.useState)(w??null),[S,b]=(0,n.useState)(d);(0,n.useEffect)((()=>{let e=E?.find((e=>e?.value===v?.value));b(e?e?.actualValue:d)}),[d]);return n.createElement("div",{className:"bg-white p-24 shadow-sm rounded-3 h-100"},n.createElement("div",{className:"d-flex justify-content-between align-items-center mb-16"},n.createElement("div",{className:"d-flex align-items-center position-relative"},t&&n.createElement("div",{className:"icon-card rounded-circle me-16 ",style:{background:m(a,.15)}},n.createElement("span",{className:"icon arrow d-inline-block align-text-bottom ms-auto",style:{WebkitMaskImage:`url(${t})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center",backgroundColor:m(a)}})),n.createElement("h6",{className:"mb-0 fw-medium text-gray-900"},e),f&&n.createElement(n.Fragment,null,n.createElement(r.g,{"data-tooltip-id":"tooltipTable","data-tooltip-content":f,className:"mx-sm fs-12 mb-1",icon:o.mEO}),n.createElement(c.A,{id:"tooltipTable"}))),E&&n.createElement(l.J0,{value:v,options:E,className:"fs-sm",isBorder:!0,onChange:e=>{N(e),e?.actualValue&&b(e?.actualValue)},isSearchable:!1})),n.createElement("div",{className:"d-flex justify-content-between position-relative"},p===s.s.LOADING&&n.createElement(l.ee,{className:"d-flex justify-content-start align-items-center bg-white",size:"10px"}),n.createElement("h3",{className:"mb-0 fw-medium fs-24"},S),n.createElement("div",{className:"d-flex flex-wrap align-item-center"},h&&n.createElement("div",{className:"d-flex w-100 mb-sm justify-content-end"},n.createElement("span",{className:"icon-grown arrow d-inline-block align-text-bottom ms-auto text-primary "+(g?"bg-green":"bg-red"),style:{WebkitMaskImage:`url(${i._K2.PUBLIC_URL}${g?"/assets/images/grown-up.svg":"/assets/images/grown-down.svg"})`,WebkitMaskRepeat:"no-repeat",WebkitMaskPosition:"center"}}),n.createElement("span",{className:(g?"text-green":"text-danger")+" fw-semibold"},g?"+":"-",h)),n.createElement("div",{className:"w-100 text-gray fs-sm text-end"},u))))}},44354:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(46942),n=a.n(s),l=a(96540),i=a(5556),r=a.n(i),o=a(36519),c=a(74848);r().string,r().bool,r().bool,r().bool,r().bool;const m=l.forwardRef((({bsPrefix:e,className:t,fluid:a=!1,rounded:s=!1,roundedCircle:l=!1,thumbnail:i=!1,...r},m)=>(e=(0,o.oU)(e,"img"),(0,c.jsx)("img",{ref:m,...r,className:n()(t,a&&`${e}-fluid`,s&&"rounded",l&&"rounded-circle",i&&`${e}-thumbnail`)}))));m.displayName="Image";const d=m}}]);