"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[5370],{55370:(t,e,s)=>{s.r(e),s.d(e,{default:()=>D});var i=s(51345),a=s(50227),l=s(4966),n=s(51751),o=s(53800),r=s(81252),c=s(96540),d=s(32389),h=s(44015),w=s(56347),u=s(27813),m=s(99194),p=s(44011),g=s(95093),M=s.n(g),L=s(418),f=class{constructor(){(0,r.M)(this,"getFlowList",(async(t,e,s,i)=>{try{const a=new m.L20,l=await a.getFlowList(t,e);l&&"AxiosError"!==l?.name?(0,u.h5)((()=>{s(l)})):i({message:l?.response?.data?.error||"Something went wrong from Server response"})}catch(t){(0,u.h5)((()=>{t.response?.data.message?i({message:t.response?.data?.message}):i({message:t?.response?.data?._messages?t.response?.data?._messages[0]?.message:"Something went wrong from Server response"})}))}}))}},E=class{constructor(t,e){(0,r.M)(this,"countriesStore",null),(0,r.M)(this,"status",n.s.READY),(0,r.M)(this,"globalStoreViewModel",null),(0,r.M)(this,"countriesTableData",null),(0,r.M)(this,"sortBy",{"sort[]":"","sort_direction[]":""}),(0,r.M)(this,"dataFilterFlowList",{}),(0,r.M)(this,"initialize",((t,e)=>{this.getFlowList(t,e)})),(0,r.M)(this,"getFlowList",((t,e,s={"sort[]":"start","sort_direction[]":"desc"})=>{this.status=n.s.LOADING,this.sortBy=s,this.dataFilter={page_size:"20",...this.dataFilter,...t,...this.sortBy};const i={...this.globalStoreViewModel.dateFilter,...e};this.countriesStore.getFlowList(this.dataFilter,i,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"handleFilter",(t=>{this.status=n.s.LOADING,this.dataFilter={...this.dataFilter,...t};const e={...this.globalStoreViewModel.dateFilter};this.countriesStore.getFlowList(this.dataFilter,e,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler)})),(0,r.M)(this,"handleFilterDateRange",((t,e)=>{this.status=n.s.LOADING;let s={date_start:M()(t).format("YYYY-MM-DD"),date_end:M()(e).endOf("day").format("YYYY-MM-DD")};this.initialize(this.dataFilter,s)})),(0,r.M)(this,"handleFilterFlowList",(async t=>{const e=p.b6.location;this.status=n.s.LOADING,this.dataFilterFlowList={...this.dataFilter,...t},this.globalStoreViewModel.dataFilter={pagination:this.dataFilterFlowList?.page};const s={...this.globalStoreViewModel.dateFilter};if(await this.countriesStore.getFlowList(this.dataFilterFlowList,s,this.callbackOnCountriesSuccessHandler,this.callbackOnErrorHandler),t?.page){const s={...L.A.parse(e.search),pagination:t?.page};window.history.replaceState("","",`/visitors/flow?${L.A.stringify(s)}`)}})),(0,r.M)(this,"callbackOnErrorHandler",(t=>{this.status=n.s.READY,(0,p.me)(t.message,"error")})),(0,r.M)(this,"callbackOnCountriesSuccessHandler",(t=>{if(t){if("canceled"!==t?.message&&"isCancle"!==t?.message){this.status=n.s.READY;const e=new a.e(t.list,this.globalStoreViewModel);this.countriesTableData={list:e,pagination:t.pagination}}}else this.status=n.s.ERROR,this.data=[]})),(0,u.l_)(this),this.countriesStore=t,this.globalStoreViewModel=e}},Y=class{constructor(t,e){(0,r.M)(this,"flowListListViewModel",null),(0,r.M)(this,"getFlowListListViewModel",(()=>this.flowListListViewModel)),t&&(this.flowListListViewModel=new E(t,e))}},v=(0,c.lazy)((()=>Promise.all([s.e(3651),s.e(7171)]).then(s.bind(s,57171)))),b=({link:t,...e})=>{if("visitors-flow"===t)return c.createElement(v,{...e})},F=(0,h.PA)(class extends c.Component{constructor(t){super(t),(0,r.M)(this,"flowListStore",null),(0,r.M)(this,"flowListViewModel",null),(0,r.M)(this,"componentDidMount",(()=>{this.props.integration||"/"!==p.b6.location.pathname||p.b6.push(`${this.biListViewModel.activeDomain}`)}));const{viewModel:e}=t;this.viewModel=e||null,this.biListViewModel=this.viewModel?this.viewModel.getBiListViewModel():null,this.flowListStore=new f,this.flowListViewModel=new Y(this.flowListStore,this.biListViewModel)}render(){const{integration:t=!1}=this.props,{integrationLink:e,activeDomain:s}=this.biListViewModel;return c.createElement(i.j,{viewModel:this.flowListViewModel},c.createElement(l.d,{data:this?.flowListViewModel?.flowListListViewModel?.countriesTableData?.list?.data,i18n:this.props.i18n,t:this.props.t,componentRef:this.componentRef,sectionName:"location"}),c.createElement(S,{ref:t=>this.componentRef=t,integration:t,integrationLink:e,activeDomain:s}))}}),S=(0,h.PA)(class extends c.Component{constructor(t){super(t)}render(){return c.createElement("div",{className:"aesirxui"},this.props.integration?c.createElement(b,{link:this.props.integrationLink,activeDomain:this.props.activeDomain,...this.props}):c.createElement(c.Fragment,null,c.createElement(w.qh,{exact:!0,path:["/visitors/flow","/bi/visitors/flow"]},c.createElement(v,{...this.props}))))}}),D=(0,d.CI)()((0,w.y)((0,o.cm)(F)))},50227:(t,e,s)=>{s.d(e,{e:()=>c});var i=s(81252),a=s(96540),l=s(99194),n=s(95093),o=s.n(n),r=s(54625),c=class{constructor(t,e){(0,i.M)(this,"data",[]),(0,i.M)(this,"globalViewModel",null),(0,i.M)(this,"toRaw",(()=>this.data)),(0,i.M)(this,"handleChangeLink",((t,e)=>{t.preventDefault(),e&&this.globalViewModel.setIntegrationLink(e)})),(0,i.M)(this,"toFlowListTable",(t=>{const e=["txt_time_utc","txt_locale","txt_sop_id","txt_event","txt_conversion","txt_url",""],s=[l.dsY.START,l.dsY.GEO,l.dsY.SOP_ID,l.dsY.EVENT,l.dsY.CONVERSION,l.dsY.URL,l.dsY.UUID];if(this.data?.length){const i=s.map(((s,i)=>({Header:e[i],accessor:s,width:s===l.dsY.START?100:s===l.dsY.SOP_ID?80:s===l.dsY.EVENT||s===l.dsY.CONVERSION||s===l.dsY.GEO?20:s===l.dsY.URL?230:s===l.dsY.UUID?80:170,allowSort:s!==l.dsY.EVENT&&s!==l.dsY.CONVERSION&&s!==l.dsY.URL&&s!==l.dsY.SOP_ID&&s!==l.dsY.GEO,Cell:({cell:e,column:s,row:i})=>{if(s.id===l.dsY.GEO)return a.createElement("div",{className:"px-3"},""===e?.value?a.createElement(a.Fragment,null):a.createElement("span",{className:`me-1 fi fi-${this.data.find((t=>t[l.dsY.GEO]?.country?.code===i?.values[l.dsY.GEO]?.country?.code))?.[l.dsY.GEO]?.country?.code?.toLowerCase()}`}),a.createElement("span",{className:"text-nowrap"},""===e?.value?"Unknown":""));if(s.id===l.dsY.UUID)return a.createElement(a.Fragment,null,t?a.createElement("a",{href:"#",onClick:t=>this.handleChangeLink(t,`flow&id=${e?.value}`),className:"btn btn-light px-3 py-1 fs-sm"},a.createElement("span",null," View Detail")):a.createElement(r.k2,{to:`/flow/${e?.value}`,className:"btn btn-light px-3 py-1 fs-sm"},"View Detail"));if(s.id===l.dsY.URL&&e?.value){const t=new URL(e?.value);let s=""===t?"Unknown":t.pathname+t.search;return a.createElement("a",{href:e?.value,target:"_blank",rel:"noreferrer",className:"px-3 d-inline-block text-secondary-50"},s?.length>53?s?.slice(0,53)+"...":s)}return s.id===l.dsY.START?a.createElement("div",{className:"px-3"},o()(e?.value)?.utc()?.format("DD-MM-YYYY HH:mm:ss")):a.createElement("div",{className:"px-3"},e?.value)}}))),n=this.data?.map((t=>({...t,...s.map((e=>({[e]:t[e]}))).reduce(((t,e)=>({...e,...t})),{})}))),c=n?.map((t=>{for(let e in t)s.includes(e)||delete t[e];return t}));return{header:i,data:c}}return{header:[],data:[]}})),t&&(this.data=t??[],this.globalViewModel=e)}}},51345:(t,e,s)=>{s.d(e,{J:()=>n,j:()=>l});var i=s(96540),a=i.createContext(),l=({children:t,viewModel:e})=>i.createElement(a.Provider,{value:e},t),n=t=>e=>i.createElement(t,{...e,viewModel:i.useContext(a)})}}]);